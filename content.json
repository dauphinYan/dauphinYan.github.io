{"posts":[{"title":"éšè®°","text":"2025-2-13åŠ›æ‰£é¢˜æµ·æ— æ¶¯ï¼Œåˆ·åˆ°æ‰‹è½¯å¿ƒåŠ›å°½ï¼› ç®—æ³•éš¾å…³å¦‚å±±é«˜ï¼Œè§£æ—¶å¤´æ˜çœ¼èŠ±é‡ã€‚ 2025-4-3è¡Œè·¯éš¾ï¼Œè¡Œè·¯éš¾ï¼Œå¤šæ­§è·¯ï¼Œä»Šå®‰åœ¨ï¼Ÿ æ˜¥æ‹›æ¸¸æˆå®¢æˆ·ç«¯å¯¹äºåŒéè¿˜æ˜¯å¤ªéš¾äº†ï¼","link":"/2025/02/13/Note/"},{"title":"Java Stream","text":"Streamæ¦‚è¿°Streamæ˜¯Java8ä¸­å¤„ç†é›†åˆçš„å…³é”®æŠ½è±¡æ¦‚å¿µï¼Œå®ƒå¯ä»¥æŒ‡å®šä½ å¸Œæœ›å¯¹é›†åˆè¿›è¡Œçš„æ“ä½œï¼Œå¯ä»¥æ‰§è¡Œéå¸¸å¤æ‚æŸ¥æ‰¾ã€è¿‡æ»¤å’Œæ˜ å°„æ•°æ®ç­‰æ“ä½œã€‚æˆ‘ä»¬é€šå¸¸å€ŸåŠ©Stream APIå¯¹é›†åˆæ•°æ®è¿›è¡Œæ“ä½œã€‚ ç®€å•è¯´ä¸€ä¸‹ä½¿ç”¨Streamæ—¶ä¼šå‘ç”Ÿçš„æ­¥éª¤ï¼š 1è·å–ä¸€ä¸ªæ•°æ®æº -&gt; æ•°æ®è½¬æ¢ -&gt; æ‰§è¡Œæ“ä½œè·å–ç»“æœ è·å–ä¸€ä¸ªæ•°æ®æº Streamæœ¬èº«å¹¶ä¸ä¼šå­˜å‚¨æ•°æ®ï¼Œè€Œæ˜¯å¯¹æ•°æ®æºçš„ä¸€ç§æŠ½è±¡è§†å›¾ï¼Œå®ƒæ›´åƒä¸€ä¸ªç®¡é“ã€‚è®¸å“Ÿå•Šæ³¨æ„çš„æ˜¯ï¼ŒStreamå¹¶ä¸ä¼šæ”¹å˜åŸå§‹æ•°æ®ã€‚ è¿™é‡Œç®¡é“å¯ä»¥å¦‚ä½•ç†è§£å‘¢ï¼Ÿå°±å¥½æ¯”ç”Ÿäº§çº¿ä¸ŠæµåŠ¨çš„ä¼ é€å¸¦ï¼ŒStreamè´Ÿè´£å¯¹è¿™äº›ææ–™è¿›è¡ŒåŠ å·¥å¤„ç†ã€‚ 12List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5);Stream&lt;Integer&gt; stream = list.stream(); // åˆ›å»ºæ•°æ®æº æ•°æ®è½¬æ¢ æ•°æ®è½¬æ¢é€šå¸¸ä¼šå€ŸåŠ©ä¸€äº›ä¸­é—´æ“ä½œï¼Œä¾‹å¦‚ï¼š mapï¼šå°†å…ƒç´ æ˜ å°„ä¸ºæ–°å€¼ã€‚ filterï¼šè¿‡æ»¤æ‰ä¸ç¬¦åˆæ¡ä»¶çš„å…ƒç´ ã€‚ ç­‰ç­‰â€¦ 1Stream&lt;Integer&gt; NewStream = stream.filter(n -&gt; n % 2 == 0); æ‰§è¡Œæ“ä½œè·å–ç»“æœ Streamçš„è®¡ç®—æ˜¯æƒ°æ€§æ±‚å€¼çš„ï¼Œåªæœ‰åœ¨æ‰§è¡Œç»ˆç«¯æ“ä½œæ—¶æ‰ä¼šè¿›è¡Œå®é™…è®¡ç®—ï¼Œä¾‹å¦‚ï¼š collectï¼šæ”¶é›†ç»“æœåˆ°é›†åˆã€‚ forEachï¼šéå†ã€‚ ç­‰ç­‰â€¦ 1List&lt;Integer&gt; result = NewStream.collect(Collectors.toList()); Streamä½¿ç”¨æµçš„åˆ›å»ºæ“ä½œ1ã€ Streamå¯ä»¥é€šè¿‡Collectionåˆ›å»ºã€‚ 123List&lt;String&gt; list = new ArrayList&lt;&gt;();Stream&lt;String&gt; stream = list.stream(); //è·å–ä¸€ä¸ªé¡ºåºæµStream&lt;String&gt; parallelStream = list.parallelStream(); //è·å–ä¸€ä¸ªå¹¶è¡Œæµ è¿™é‡Œè§£é‡Šä¸€ä¸‹streamå’ŒparallelStreamçš„åŒºåˆ«ï¼š streamæ˜¯é¡ºåºæµï¼Œå®ƒæ˜¯ä¾ç…§ä¸»çº¿ç¨‹çš„é¡ºåºå¯¹æµè¿›è¡Œæ“ä½œã€‚ parallelStreamæ˜¯å¹¶è¡Œæµï¼Œä¾ç…§å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„æ–¹å¼å¯¹æµè¿›è¡Œæ“ä½œï¼Œå› æ­¤ä¸ä¿è¯é¡ºåºã€‚ 2ã€Streamå¯ä»¥é€šè¿‡Arrayåˆ›å»ºã€‚ 12int[] array = { 1, 3, 5, 6, 8 };IntStream stream = Arrays.stream(array); 3ã€Streamå¯ä»¥é€šè¿‡é™æ€æ–¹æ³•ï¼šof()ã€iterate()ã€generate()åˆ›å»ºã€‚ 1234567Stream&lt;Integer&gt; stream = Stream.of(1, 2, 3, 4, 5, 6);Stream&lt;Integer&gt; stream2 = Stream.iterate(0, (x) -&gt; x + 3).limit(4);stream2.forEach(System.out::println);Stream&lt;Double&gt; stream3 = Stream.generate(Math::random).limit(3);stream3.forEach(System.out::println); æµçš„ä¸­é—´æ“ä½œç­›é€‰ç­›é€‰ä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™æ ¡éªŒæµä¸­çš„å…ƒç´ ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„å…ƒç´ æå–è‡³æ–°çš„æµä¸­ï¼Œå¸¸è§çš„æ“ä½œå¦‚ä¸‹ï¼š filter()ï¼šæ ¹æ®æ¡ä»¶è¿‡æ»¤ã€‚ limit(n)ï¼šè·å–nä¸ªå…ƒç´ ã€‚ skip(n)ï¼šè·³è¿‡nä¸ªå…ƒç´ ã€‚ distinct()ï¼šå»é™¤é‡å¤å…ƒç´ ã€‚ 1234567Stream&lt;Integer&gt; stream = Stream.of(6, 4, 6, 7, 3, 9, 8, 10, 12, 14, 14);Stream&lt;Integer&gt; newStream = stream.filter(s -&gt; s &gt; 5) // 6 6 7 9 8 10 12 14 14 .distinct() // 6 7 9 8 10 12 14 .skip(2) // 9 8 10 12 14 .limit(2); // 9 8newStream.forEach(System.out::println); æ˜ å°„æ˜ å°„å¯ä»¥å°†ä¸€ä¸ªæµçš„å…ƒç´ æŒ‰ç…§ä¸€å®šçš„æ˜ å°„è§„åˆ™æ˜ å°„åˆ°å¦ä¸€ä¸ªæµä¸­ã€‚åˆ†ä¸ºmapå’ŒflatMap mapï¼šæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°ä¼šè¢«åº”ç”¨åˆ°æ¯ä¸ªå…ƒç´ ä¸Šï¼Œå¹¶å°†å…¶æ˜ å°„æˆä¸€ä¸ªæ–°çš„å…ƒç´ ã€‚ flatMapï¼šæ¥æ”¶ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œå°†æµä¸­çš„æ¯ä¸ªå€¼éƒ½æ¢æˆå¦ä¸€ä¸ªæµï¼Œç„¶åæŠŠæ‰€æœ‰æµè¿æ¥æˆä¸€ä¸ªæµã€‚ 12345678910111213List&lt;String&gt; list = Arrays.asList(&quot;a,b,c&quot;, &quot;1,2,3&quot;); //å°†æ¯ä¸ªå…ƒç´ è½¬æˆä¸€ä¸ªæ–°çš„ä¸”ä¸å¸¦é€—å·çš„å…ƒç´ Stream&lt;String&gt; s1 = list.stream().map(s -&gt; s.replaceAll(&quot;,&quot;, &quot;&quot;));s1.forEach(System.out::println); // abc 123 Stream&lt;String&gt; s3 = list.stream().flatMap(s -&gt; {//å°†æ¯ä¸ªå…ƒç´ è½¬æ¢æˆä¸€ä¸ªstreamString[] split = s.split(&quot;,&quot;);Stream&lt;String&gt; s2 = Arrays.stream(split);return s2;});s3.forEach(System.out::println); // a b c 1 2 3 æµçš„ç»ˆæ­¢æ“ä½œéå†12Stream&lt;Integer&gt; stream = Stream.of(6, 4, 6, 7, 3, 9, 8, 10, 12, 14, 14);stream.forEach(System.out::println); åŒ¹é…Streamä¸­çš„å…ƒç´ æ˜¯ä»¥Optionalç±»å‹å­˜åœ¨çš„ã€‚ 1234567List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5, 6);Optional&lt;Integer&gt; findFirst = list.stream().filter(x -&gt; x &gt; 3).findFirst();Optional&lt;Integer&gt; findAny = list.parallelStream().filter(x -&gt; x &gt; 3).findAny();System.out.println(&quot;åŒ¹é…ç¬¬ä¸€ä¸ªå€¼ï¼š&quot; + findFirst.get());System.out.println(&quot;åŒ¹é…ä»»æ„ä¸€ä¸ªå€¼ï¼š&quot; + findAny.get()); è¾“å‡ºç»“æœä¸º 12åŒ¹é…ç¬¬ä¸€ä¸ªå€¼ï¼š4åŒ¹é…ä»»æ„ä¸€ä¸ªå€¼ï¼š4 å½’çº¦ reduceé€šå¸¸åˆ†ä¸ºä¸‰ç±»ï¼š Optional reduce1Optional&lt;T&gt; reduce(BinaryOperator&lt;T&gt; accumulator) ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œaccumulatorå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæµä¸­å…ƒç´ çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼›ç¬¬äºŒæ¬¡æ‰§è¡Œæ—¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç¬¬ä¸€æ¬¡å‡½æ•°æ‰§è¡Œçš„ç»“æœï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæµä¸­çš„ç¬¬ä¸‰ä¸ªå…ƒç´ ï¼›ä¾æ¬¡ç±»æ¨ã€‚ ç¤ºä¾‹ï¼š 1234567List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5);// æ±‚å’ŒOptional&lt;Integer&gt; sum = list.stream() .reduce((a, b) -&gt; a + b);System.out.println(sum.get()); // è¾“å‡º 15 T reduce1T reduce(T identity, BinaryOperator&lt;T&gt; accumulator) æµç¨‹åŸºæœ¬ä¸€è‡´ï¼Œä¸è¿‡ç¬¬ä¸€æ¬¡æ‰§è¡Œæ—¶ï¼Œaccumulatorå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºidentityï¼Œè€Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæµä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚ 1234567List&lt;Integer&gt; list = Arrays.asList(1, 2, 3, 4, 5);// å¸¦åˆå§‹å€¼çš„æ±‚å’Œint sum = list.stream() .reduce(0, (a, b) -&gt; a + b);System.out.println(sum); // è¾“å‡º 15 U reduce1&lt;U&gt; U reduce(U identity, BiFunction&lt;U,? super T,U&gt; accumulator, BinaryOperator&lt;U&gt; combiner) ä¸»è¦ç”¨äºå¹¶è¡Œæµï¼Œæˆ‘ä»¬çŸ¥é“å¹¶è¡Œæµä¸­æ•°æ®ä¼šè¢«æ‹†åˆ†ç»™å¤šä¸ªçº¿ç¨‹è¿›è¡Œæ‰§è¡Œï¼Œæ­¤æ—¶æ¯ä¸ªçº¿ç¨‹çš„å¤„ç†æµç¨‹ä¼šæŒ‰ç…§T reduceæ‰§è¡Œï¼›ç¬¬ä¸‰ä¸ªå‚æ•°combinerï¼Œä¼šå°†æ¯ä¸ªçº¿ç¨‹çš„æ‰§è¡Œç»“æœå½“æˆä¸€ä¸ªæ–°çš„æµï¼Œç„¶åä½¿ç”¨ç¬¬ä¸€ä¸ªæ–¹æ³•reduce(accumulator)æµç¨‹è¿›è¡Œå½’çº¦ã€‚ æ”¶é›† Collectoré¡¾åæ€ä¹‰ï¼ŒCollectorçš„èŒè´£å°±æ˜¯å°†æµä¸­çš„æ•°æ®é‡æ–°å½’é›†åˆ°ä¸€èµ·ã€‚ è¿™é‡Œä»¥toList()ä¸ºä¾‹ï¼š 123Stream&lt;Integer&gt; stream = Stream.of(6, 4, 6, 7, 3, 9, 8, 10, 12, 14, 14);List&lt;Integer&gt; list = stream.collect(Collectors.toList());list.forEach(System.out::println); æŸ¥çœ‹collectæ–¹æ³•å£°æ˜ï¼š 12&lt;R, A&gt; R collect(Collector&lt;? super T, A, R&gt; collector); å†æ ¹æ®ä¸‹æ–¹toList()è¿”å›å€¼ç±»å‹å¯ä»¥çŸ¥é“å½“å‰stream.collect()çš„è¿”å›ç±»å‹æ˜¯List&lt;T&gt;ã€‚ 12345public static &lt;T&gt;Collector&lt;T, ?, List&lt;T&gt;&gt; toList() { return new CollectorImpl&lt;&gt;((Supplier&lt;List&lt;T&gt;&gt;) ArrayList::new, List::add, (left, right) -&gt; { left.addAll(right); return left; }, CH_ID); å¯ä»¥çœ‹åˆ°toList()è¿”å›å€¼ç±»å‹ä¸ºCollector&lt;T, ?, List&lt;T&gt;&gt;ï¼ŒCollectorImplå®ç°äº†æ¥å£Collector&lt;T, A, R&gt;ã€‚ 1static class CollectorImpl&lt;T, A, R&gt; implements Collector&lt;T, A, R&gt; CollectorImplå®ç°å¦‚ä¸‹ï¼š 123456CollectorImpl(Supplier&lt;A&gt; supplier, BiConsumer&lt;A, T&gt; accumulator, BinaryOperator&lt;A&gt; combiner, Set&lt;Characteristics&gt; characteristics) { this(supplier, accumulator, combiner, castingIdentity(), characteristics);} supplierï¼šç©ºçš„ç´¯åŠ å™¨ã€‚ accumulatorï¼šç´¯åŠ æ“ä½œã€‚ combinerï¼šåˆå¹¶æ“ä½œã€‚ characteristicsï¼šæ”¶é›†å™¨ç‰¹æ€§ã€‚","link":"/2025/08/24/java/Java-Stream/"},{"title":"Rediså­¦ä¹ ï¼ˆ1ï¼‰","text":"å‰è¨€Redisæ˜¯ç›®å‰æœ€ç«çˆ†çš„å†…å­˜æ•°æ®åº“ä¹‹ä¸€ï¼Œé€šè¿‡å†å†…å­˜ä¸­è¯»å†™æ•°æ®ï¼Œä»è€Œå¤§å¤§æé«˜è¯»å†™é€Ÿåº¦ï¼Œå¯ä»¥è¯´Redisæ˜¯å®ç°ç½‘ç«™é«˜å¹¶å‘ä¸å¯æˆ–ç¼ºçš„ä¸€éƒ¨åˆ†ã€‚ ä¸€ã€Rediså†…å­˜ç»Ÿè®¡å®¢æˆ·ç«¯å€ŸåŠ©redis-cli.exeè¿æ¥æœåŠ¡å™¨åï¼Œå¯ä»¥ä½¿ç”¨infoå‘½ä»¤æŸ¥çœ‹redisæœåŠ¡å™¨çš„å†…å­˜ä½¿ç”¨æƒ…å†µï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243C:\\Users\\58448&gt;redis-cli.exe127.0.0.1:6379&gt; info memory# Memoryused_memory:722248used_memory_human:705.32Kused_memory_rss:681224used_memory_rss_human:665.26Kused_memory_peak:722248used_memory_peak_human:705.32Kused_memory_peak_perc:100.00%used_memory_overhead:710278used_memory_startup:660328used_memory_dataset:11970used_memory_dataset_perc:19.33%allocator_allocated:39412272allocator_active:524288000allocator_resident:532676608total_system_memory:0total_system_memory_human:0Bused_memory_lua:37888used_memory_lua_human:37.00Kused_memory_scripts:0used_memory_scripts_human:0Bnumber_of_cached_scripts:0maxmemory:0maxmemory_human:0Bmaxmemory_policy:noevictionallocator_frag_ratio:13.30allocator_frag_bytes:484875728allocator_rss_ratio:1.02allocator_rss_bytes:8388608rss_overhead_ratio:0.00rss_overhead_bytes:-531995384mem_fragmentation_ratio:1.00mem_fragmentation_bytes:0mem_not_counted_for_evict:0mem_replication_backlog:0mem_clients_slaves:0mem_clients_normal:49950mem_aof_buffer:0mem_allocator:jemalloc-5.2.1-redisactive_defrag_running:0lazyfree_pending_objects:0 used_memoryï¼šRedisåˆ†é…å™¨çš„å†…å­˜æ€»é‡ï¼ŒåŒ…æ‹¬ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ï¼Œå•ä½æ˜¯å­—èŠ‚ã€‚used_memory_humanä¸»è¦æ–¹ä¾¿äººæŸ¥çœ‹ã€‚ used_memory_rssï¼šRedisè¿›ç¨‹å æ®æ“ä½œç³»ç»Ÿçš„å†…å­˜ï¼Œå•ä½æ˜¯å­—èŠ‚ï¼Œä¸åŒ…æ‹¬è™šæ‹Ÿå†…å­˜ã€‚ äºŒã€Rediså†…å­˜åˆ’åˆ†1. æ•°æ®Redisä½œä¸ºæ•°æ®åº“ï¼Œæ•°æ®æ˜¯æœ€ä¸»è¦çš„éƒ¨åˆ†ï¼›è¿™éƒ¨åˆ†å ç”¨çš„å†…å­˜ä¼šç»Ÿè®¡åœ¨used_memoryä¸­ã€‚ Redisä½¿ç”¨é”®å€¼å¯¹å­˜å‚¨æ•°æ®ï¼Œå…¶ä¸­çš„å€¼åŒ…æ‹¬5ç§ç±»å‹ï¼Œå³å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆã€‚åœ¨Rediså†…éƒ¨ï¼Œæ¯ç§ç±»å‹å¯èƒ½æœ‰2ç§æˆ–æ›´å¤šçš„å†…éƒ¨ç¼–ç å®ç°ï¼›æ­¤å¤–ï¼ŒRedisåœ¨å­˜å‚¨å¯¹è±¡æ—¶ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å°†æ•°æ®æ‰”è¿›å†…å­˜ï¼Œè€Œæ˜¯ä¼šå¯¹å¯¹è±¡è¿›è¡ŒåŒ…è£…ï¼šä¾‹å¦‚redisObjectã€SDSç­‰ã€‚ 2. è¿›ç¨‹æœ¬èº«è¿è¡Œéœ€è¦çš„å†…å­˜Redisä¸»è¿›ç¨‹æœ¬èº«è¿è¡Œè‚¯å®šéœ€è¦å ç”¨å†…å­˜ï¼Œå¦‚ä»£ç ã€å¸¸é‡æ± ç­‰ç­‰ã€‚è¿™éƒ¨åˆ†å†…å­˜å¤§çº¦å‡ å…†ï¼Œåœ¨å¤§å¤šæ•°ç”Ÿäº§ç¯å¢ƒä¸­ä¸Redisæ•°æ®å ç”¨çš„å†…å­˜ç›¸æ¯”å¯ä»¥å¿½ç•¥ã€‚è¿™éƒ¨åˆ†å†…å­˜ä¸æ˜¯ç”±jemallocåˆ†é…ï¼Œå› æ­¤ä¸ä¼šç»Ÿè®¡åœ¨used_memoryä¸­ã€‚ é™¤ä¸»è¿›ç¨‹å¤–ï¼ŒRedisåˆ›å»ºçš„å­è¿›ç¨‹ä¹Ÿä¼šå ç”¨å†…å­˜ï¼Œå¦‚Redisæ‰§è¡ŒAOFã€RDBé‡å†™æ—¶åˆ›å»ºçš„å­è¿›ç¨‹ã€‚åŒæ ·è¿™éƒ¨åˆ†å ç”¨çš„å†…å­˜ä¹Ÿä¸ä¼šç»Ÿè®¡åœ¨used_memoryå’Œused_memory_rssä¸­ã€‚ 3. ç¼“å†²å†…å­˜ç¼“å†²å†…å­˜åŒ…æ‹¬å®¢æˆ·ç«¯ç¼“å†²åŒºã€å¤åˆ¶ç§¯å‹ç¼“å†²åŒºã€AOFç¼“å†²åŒºç­‰ï¼Œè¿™éƒ¨åˆ†å†…å­˜ç”±jemallocåˆ†é…ï¼Œå› æ­¤ä¼šç»Ÿè®¡åœ¨used_memoryä¸­ã€‚ â€¢ å®¢æˆ·ç«¯ç¼“å†²åŒºï¼šæ¯ä¸ªå®¢æˆ·ç«¯è¿æ¥åœ¨ Redis æœåŠ¡å™¨ç«¯å¯¹åº”çš„è¾“å…¥ç¼“å†²åŒºå’Œè¾“å‡ºç¼“å†²åŒºã€‚ â€¢ å¤åˆ¶æŒ¤å‹ç¼“å†²åŒºï¼šä¸»èŠ‚ç‚¹ä¸“é—¨ä¸ºä»èŠ‚ç‚¹å‡†å¤‡çš„å†™å‘½ä»¤å†å²è®°å½•ç¼“å­˜ã€‚ä¸»èŠ‚ç‚¹æ‰§è¡Œå†™å‘½ä»¤æ—¶ï¼Œä¸ä»…åº”ç”¨åˆ°è‡ªèº«æ•°æ®ï¼Œä¹Ÿä¼šæŠŠè¿™äº›å†™æ“ä½œåºåˆ—åŒ–æˆå¤åˆ¶æµï¼Œå¹¶å†™å…¥è¿™å—ç¼“å†²åŒºã€‚ â€¢ AOFç¼“å†²åŒºï¼šRedis åœ¨å¼€å¯AOFæŒä¹…åŒ–æ—¶ï¼Œç”¨æ¥æš‚å­˜æœ€è¿‘å†™å‘½ä»¤çš„å†…å­˜ç¼“å†²åŒºã€‚ 4. å†…å­˜ç¢ç‰‡å†…å­˜ç¢ç‰‡æ˜¯åœ¨ Redis åˆ†é…å’Œå›æ”¶å†…å­˜è¿‡ç¨‹ä¸­äº§ç”Ÿçš„ã€‚å½“æ•°æ®é¢‘ç¹ä¿®æ”¹ã€ä¸”å¯¹è±¡å¤§å°å·®å¼‚è¾ƒå¤§æ—¶ï¼ŒRedis é‡Šæ”¾çš„å†…å­˜å¯èƒ½ä»ä¿ç•™åœ¨å†…å­˜åˆ†é…å™¨çš„å†…å­˜æ± ä¸­ï¼Œæœªç«‹å³å½’è¿˜ç»™æ“ä½œç³»ç»Ÿï¼Œä¹Ÿå¯èƒ½æ— æ³•è¢«åç»­å¯¹è±¡æœ‰æ•ˆåˆ©ç”¨ï¼Œä»è€Œå½¢æˆå†…å­˜ç¢ç‰‡ã€‚ ä¸‰ã€Redisæ•°æ®å­˜å‚¨çš„ç»†èŠ‚1. æ¦‚è¿°æ‰§è¡Œset hello worldå‘½ä»¤æ—¶æ¶‰åŠåˆ°çš„æ•°æ®æ¨¡å‹ï¼š dictEntryï¼šæ˜¯Rediså­—å…¸ä¸­å­˜å‚¨é”®å€¼å¯¹çš„åŸºæœ¬å•å…ƒã€‚ keyï¼šæŒ‡å‘é”®çš„æŒ‡é’ˆï¼Œé”®çš„ç±»å‹æ˜¯sdsï¼ˆredisè‡ªå®šä¹‰çš„å­—ç¬¦ä¸²ç»“æ„ï¼‰ã€‚ valï¼šæŒ‡å‘å€¼çš„æŒ‡é’ˆï¼Œè¿™é‡Œå€¼çš„ç±»å‹æ˜¯redisObjectï¼ˆredisæ‰€æœ‰æ•°æ®ç±»å‹çš„ç»Ÿä¸€å°è£…å¯¹è±¡ï¼‰ã€‚ nextï¼šæŒ‡å‘å¦ä¸€ä¸ªdictEntryçš„æŒ‡é’ˆï¼Œç”¨äºå¤„ç†å“ˆå¸Œå†²çªã€‚ redisObjectï¼šRedisä¸­æ‰€æœ‰æ•°æ®ï¼ˆå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å“ˆå¸Œç­‰ï¼‰éƒ½é€šè¿‡redisObejctå°è£…ã€‚ typeï¼šæ ‡è¯†å¯¹è±¡çš„ç±»å‹ï¼Œè¿™é‡Œæ˜¯stringã€‚ ptrï¼šæŒ‡å‘æ—¶æœºæ•°æ®çš„æŒ‡é’ˆã€‚ Sdsï¼šRedisè‡ªå®šä¹‰çš„å­—ç¬¦ä¸²å®ç°ï¼Œç›¸æ¯”CåŸç”Ÿå­—ç¬¦ä¸²æ›´é«˜æ•ˆï¼ˆæ”¯æŒåŠ¨æ€æ‰©å®¹ã€è®°å½•é•¿åº¦ç­‰ï¼‰ã€‚ Jemalloc Redisåœ¨ç¼–è¯‘æ—¶ä¼šæŒ‡å®šå†…å­˜åˆ†é…å™¨ï¼›å†…å­˜åˆ†é…å™¨å¯ä»¥æ˜¯ libc ã€jemallocæˆ–è€…tcmallocï¼Œé»˜è®¤æ˜¯jemallocã€‚ jemallocä½œä¸ºRedisçš„é»˜è®¤å†…å­˜åˆ†é…å™¨ï¼Œåœ¨å‡å°å†…å­˜ç¢ç‰‡æ–¹é¢åšçš„ç›¸å¯¹æ¯”è¾ƒå¥½ã€‚jemallocåœ¨64ä½ç³»ç»Ÿä¸­ï¼Œå°†å†…å­˜ç©ºé—´åˆ’åˆ†ä¸ºå°ã€å¤§ã€å·¨å¤§ä¸‰ä¸ªèŒƒå›´ï¼›æ¯ä¸ªèŒƒå›´å†…åˆåˆ’åˆ†äº†è®¸å¤šå°çš„å†…å­˜å—å•ä½ï¼›å½“Rediså­˜å‚¨æ•°æ®æ—¶ï¼Œä¼šé€‰æ‹©å¤§å°æœ€åˆé€‚çš„å†…å­˜å—è¿›è¡Œå­˜å‚¨ã€‚ jemallocåˆ’åˆ†çš„å†…å­˜å•å…ƒå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å› æ­¤ï¼Œå¦‚æœéœ€è¦å­˜å‚¨çš„å¯¹è±¡å¤§å°ä¸º130å­—èŠ‚ï¼Œåˆ™ä¼šå°†å…¶æ”¾å…¥160å­—èŠ‚çš„å†…å­˜å•å…ƒä¸­ã€‚ RedisObject å‰é¢æœ‰æåˆ°Redisä¸­æ‰€æœ‰æ•°æ®ï¼ˆå­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å“ˆå¸Œç­‰ï¼‰éƒ½é€šè¿‡redisObejctå°è£…ã€‚ redisObjectçš„å®šä¹‰å¦‚ä¸‹ï¼š C++ typedef struct redisObject { unsigned type:4; unsigned encoding:4; unsigned lru:REDIS_LRU_BITS; /* lru time (relative to server.lruclock) */ int refcount; void *ptr; } robj; â€¢ unsigned type:4ï¼šç”¨äºæ ‡è¯†å½“å‰å¯¹è±¡çš„æ•°æ®ç±»å‹ï¼ŒRedisæ”¯æŒçš„æ ¸å¿ƒç±»å‹åŒ…æ‹¬ï¼šREDIS_STRINGï¼ˆå­—ç¬¦ä¸²ï¼‰ã€REDIS_LISTï¼ˆåˆ—è¡¨ï¼‰ã€REDIS_HASHï¼ˆå“ˆå¸Œï¼‰ã€REDIS_SETï¼ˆé›†åˆï¼‰ã€‚4ä½äºŒè¿›åˆ¶å¯è¡¨ç¤º16ç§ç±»å‹ï¼Œé¢„ç•™äº†æ‹“å±•ç©ºé—´ã€‚ â€¢ unsigned encoding:4ï¼šæ ‡è¯†å¯¹è±¡çš„åº•å±‚å­˜å‚¨ç»“æ„ï¼ˆRedis å¯¹åŒä¸€ç§æ•°æ®ç±»å‹å¯èƒ½é‡‡ç”¨å¤šç§ç¼–ç ä»¥ä¼˜åŒ–æ€§èƒ½ï¼‰ã€‚ä¾‹å¦‚ï¼š ï¿® å­—ç¬¦ä¸²ç±»å‹ï¼ˆtype=REDIS_STRINGï¼‰çš„ç¼–ç å¯èƒ½æ˜¯ï¼š â–ª REDIS_ENCODING_RAWï¼ˆåŸç”Ÿ SDSï¼Œå­˜å‚¨é•¿å­—ç¬¦ä¸²ï¼‰ â–ª REDIS_ENCODING_INTï¼ˆç›´æ¥å­˜å‚¨æ•´æ•°ï¼Œé¿å… SDS å¼€é”€ï¼‰ ï¿® åˆ—è¡¨ç±»å‹ï¼ˆtype=REDIS_LISTï¼‰çš„ç¼–ç å¯èƒ½æ˜¯ï¼š â–ª REDIS_ENCODING_ZIPLISTï¼ˆå‹ç¼©åˆ—è¡¨ï¼Œé€‚åˆå°æ•°æ®ï¼‰ â–ª REDIS_ENCODING_LINKEDLISTï¼ˆåŒå‘é“¾è¡¨ï¼Œé€‚åˆå¤§æ•°æ®ï¼‰ã€‚ â€¢ unsigned lru:REDIS_LRU_BITSï¼šç”¨äºè®°å½•å¯¹è±¡çš„æœ€è¿‘è®¿é—®æ—¶é—´ï¼Œé…åˆ Redis çš„å†…å­˜æ·˜æ±°ç­–ç•¥ã€‚ â€¢ int refcountï¼šå¼•ç”¨è®¡æ•°ï¼Œç”¨äºå†…å­˜ç®¡ç†çš„åƒåœ¾å›æ”¶æœºåˆ¶ã€‚ â€¢ void *ptrï¼šæŒ‡å‘å¯¹è±¡çš„å®é™…å­˜å‚¨æ•°æ®ï¼Œå…·ä½“æŒ‡å‘çš„ç»“æ„ç”± encoding å†³å®šï¼š ï¿® è‹¥ encoding=REDIS_ENCODING_INTï¼Œptr ç›´æ¥æŒ‡å‘æ•´æ•°ï¼ˆé€šè¿‡æŒ‡é’ˆå¼ºè½¬å­˜å‚¨ï¼ŒèŠ‚çœç©ºé—´ï¼‰ã€‚ ï¿® è‹¥ encoding=REDIS_ENCODING_RAWï¼Œptr æŒ‡å‘ sds ç»“æ„ä½“ï¼ˆå­—ç¬¦ä¸²ï¼‰ã€‚ ï¿® è‹¥ encoding=REDIS_ENCODING_ZIPLISTï¼Œptr æŒ‡å‘å‹ç¼©åˆ—è¡¨çš„èµ·å§‹åœ°å€ã€‚ å› æ­¤ï¼Œæ¯ä¸ªredisObjectæ‰€å å¤§å°æ˜¯4bit+4bit+24bit+4Byte+8Byte=16Byteã€‚ SDS sdsç”¨äºå­˜å‚¨å­—ç¬¦ä¸²ï¼Œç»“æ„å¦‚ä¸‹ï¼š C++ struct sdshdr { int len; int free; char buf[]; }; å‚æ•°è¯´æ˜ï¼šlenè¡¨ç¤ºbufå·²ä½¿ç”¨çš„é•¿åº¦ã€freeè¡¨ç¤ºbufæœªä½¿ç”¨çš„é•¿åº¦ã€bufè¡¨ç¤ºå­—èŠ‚æ•°ç»„ã€‚ å› æ­¤ï¼Œæ¯ä¸ªsdsæ‰€å çš„å¤§å°æ˜¯4+4+len+free+1(Byte) å¯¹æ¯”Cå­—ç¬¦ä¸²ï¼š â€¢ è·å–å­—ç¬¦ä¸²é•¿åº¦ï¼šæ—¶é—´å¤æ‚åº¦SDSæ˜¯O(1)ï¼ŒCå­—ç¬¦ä¸²æ˜¯O(n)ã€‚ â€¢ ç¼“å†²åŒºæº¢å‡ºï¼šå¯¹äºCå­—ç¬¦ä¸²ï¼Œç”¨strcatæ–¹æ³•å¾€å­—ç¬¦ä¸²ä¸­æ·»åŠ å­—ç¬¦ï¼Œå¦‚åŸå…ˆåˆ†é…ç»™å­—ç¬¦ä¸²çš„ç©ºé—´ä¸å¤Ÿï¼Œä¼šå¯¼è‡´ç¼“å†²åŒºæº¢å‡ºï¼›å¯¹äºSDSä¼šæ£€æµ‹ç©ºé—´æ˜¯å¦è¶³å¤Ÿï¼Œå¦‚ç©ºé—´ä¸è¶³ä¼šè‡ªåŠ¨æ‰©å®¹ã€‚ â€¢ å­—ç¬¦ä¸²ä¿®æ”¹å†…å­˜é‡åˆ†é…ï¼šå¯¹äºCå­—ç¬¦ä¸²ï¼Œå¦‚æœå­—ç¬¦ä¸²å˜é•¿ï¼Œé‚£ä¹ˆéœ€è¦é‡æ–°åˆ†é…å†…å­˜ï¼Œå­—ç¬¦ä¸²å˜çŸ­ï¼Œä¸é‡æ–°åˆ†é…å†…å­˜é€ æˆå†…å­˜æµªè´¹ï¼›å¯¹äºSDSï¼Œåœ¨æ‰©å®¹æ—¶ä¼šåˆ†é…æ›´å¤šçš„ç©ºé—´ï¼Œä»¥å‡å°‘reallocçš„æ¬¡æ•°ï¼Œå¹¶ä¸”éµå¾ªæƒ°æ€§ç©ºé—´é‡Šæ”¾ç­–ç•¥ï¼Œå‡å°‘ç¼©å®¹çš„é¢‘ç‡ï¼Œä»¥æé«˜æ€§èƒ½ã€‚ â€¢ å­˜å–äºŒè¿›åˆ¶æ•°æ®ï¼šå¯¹äºCå­—ç¬¦ä¸²ï¼Œé€šå¸¸ä»¥ç©ºå­—ç¬¦ä½œä¸ºå­—ç¬¦ä¸²ç»“æŸçš„æ ‡å¿—ï¼Œå¯¹äºä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå†…å®¹å¯èƒ½åŒ…å«ç©ºå­—ç¬¦ï¼Œå› è€ŒCå­—ç¬¦ä¸²æ— æ³•æ­£ç¡®è¯»å–ï¼›å¯¹äºSDSåˆ™æ˜¯æ ¹æ®lenä½œä¸ºå­—ç¬¦ä¸²ç»“æŸæ ‡å¿—ï¼Œå¾ˆå¥½çš„é¿å…äº†è¿™ä¸ªé—®é¢˜ã€‚ *å››ã€Redisçš„å¯¹è±¡ç±»å‹ä¸å†…éƒ¨ç¼–ç * å‰é¢å·²ç»æåˆ°ï¼ŒRedisæ”¯æŒ5ç§å¯¹è±¡ç±»å‹ï¼Œæ¯ç§ç»“æ„éƒ½æœ‰è‡³å°‘ä¸¤ç§ç¼–ç ã€‚å¥½å¤„æ˜¯å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œä½¿ç”¨Redisåªéœ€è¦é¢å¯¹ç»Ÿä¸€çš„å‘½ä»¤å’Œæ•°æ®ç±»å‹ï¼ˆå¦‚å­—ç¬¦ä¸²ã€åˆ—è¡¨ã€å“ˆå¸Œï¼‰ï¼Œä¸ç”¨å…³å¿ƒå…¶åº•å±‚é‡‡ç”¨å“ªç§ç¼–ç ï¼›å¦ä¸€æ–¹é¢ï¼Œå¯ä»¥æ ¹æ®ä¸åŒçš„åº”ç”¨åœºæ™¯é€‰ç”¨ä¸åŒçš„å†…éƒ¨ç¼–ç ï¼Œä»¥æé«˜æ•ˆç‡ã€‚ å­—ç¬¦ä¸² 1.1 æ¦‚å†µ å­—ç¬¦ä¸²æ˜¯æœ€åŸºç¡€çš„ç±»å‹ï¼Œæ‰€æœ‰çš„é”®éƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œå…¶é•¿åº¦ä¸èƒ½è¶…è¿‡512MBã€‚ 1.2 å†…éƒ¨ç¼–ç  å­—ç¬¦ä¸²ç±»å‹çš„å†…éƒ¨ç¼–ç æœ‰3ç§ï¼š â€¢ intï¼š8ä¸ªå­—èŠ‚çš„é•¿æ•´å‹ï¼ˆæ³¨æ„ä¸æ˜¯4å­—èŠ‚ï¼‰ã€‚å­—ç¬¦ä¸²å€¼æ˜¯æ•´å‹æ—¶ï¼Œè¿™ä¸ªå€¼ä½¿ç”¨longæ•´å‹è¡¨ç¤ºã€‚ â€¢ embstrï¼š&lt;=39å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚ â€¢ rawï¼š&gt;39å­—èŠ‚çš„å­—ç¬¦ä¸²ã€‚ embsträ¸rawéƒ½ä½¿ç”¨redisObjectå’Œsdsä¿å­˜æ•°æ®ï¼ŒåŒºåˆ«åœ¨äºï¼Œembstråªåˆ†é…ä¸€æ¬¡å†…å­˜ç©ºé—´ï¼Œåªè¯»ï¼Œè€Œrawéœ€è¦åˆ†é…ä¸¤æ¬¡å†…å­˜ç©ºé—´ï¼Œä½†å¯ä¿®æ”¹ã€‚ æ³¨æ„ï¼šå¦‚æœé‡‡ç”¨embstrç¼–ç ï¼ŒRedisä¼šä¸€æ¬¡æ€§ç”³è¯·ä¸€å—è¿ç»­ç©ºé—´ï¼Œä¾‹å¦‚ï¼š C++ | redisObject | sds å¤´éƒ¨ | â€œTom\\0â€ | å¦‚æœé‡‡ç”¨rawç¼–ç ï¼Œåˆ™ä¼šåˆ†åˆ«ç”³è¯·redisObjectä¸sdsä¸¤å—å†…å­˜ï¼Œä¾‹å¦‚ï¼š C++ redisObject â€”&gt; æŒ‡å‘ â€”&gt; | sdså¤´éƒ¨ | â€œThis is a very very long string â€¦â€ | 1.3 ç¼–ç è½¬æ¢ â€¢ å½“intæ•°æ®ä¸å†æ˜¯æ•´æ•°æˆ–è€…å¤§å°è¶…è¿‡longçš„èŒƒå›´æ—¶ï¼Œåˆ™è‡ªåŠ¨è½¬æ¢ä¸ºrawã€‚ â€¢ å¯¹äºembstrï¼Œç”±äºå…¶æ˜¯åªè¯»çš„ï¼Œå› æ­¤åœ¨ä¿®æ”¹æ—¶ï¼Œéœ€è¦å…ˆå°†å…¶è½¬æ¢ä¸ºrawå†ä¿®æ”¹ã€‚ åˆ—è¡¨ 2.1 æ¦‚å†µ åˆ—è¡¨ç”¨æ¥å­˜å‚¨å¤šä¸ªæœ‰åºçš„å­—ç¬¦ä¸²ï¼Œæ¯ä¸ªå­—ç¬¦ä¸²ç§°ä¸ºå…ƒç´ ï¼›ä¸€ä¸ªåˆ—è¡¨å¯ä»¥å­˜å‚¨2^32-1ä¸ªå…ƒç´ ã€‚Redisä¸­çš„åˆ—è¡¨æ”¯æŒä¸¤ç«¯æ’å…¥ä¸åˆ é™¤ã€‚ 2.2 å†…éƒ¨ç¼–ç  åˆ—è¡¨å†…éƒ¨ç¼–ç æœ‰ä¸¤ç§ï¼š â€¢ åŒç«¯é“¾è¡¨ã€‚ â€¢ å‹ç¼©åˆ—è¡¨ï¼Œæ˜¯Redisä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œç”±ä¸€ç³»åˆ—ç‰¹æ®Šç¼–ç çš„è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„ï¼Œå› è€Œä¿®æ”¹ä¸å¢åˆ æ“ä½œçš„æ•ˆç‡ä½ï¼Œå¸¸ç”¨äºèŠ‚ç‚¹æ•°é‡å°‘çš„æƒ…å†µã€‚ 2.3 ç¼–ç è½¬æ¢ ä½¿ç”¨å‹ç¼©åˆ—è¡¨çš„æ¡ä»¶ï¼ˆéœ€åŒæ—¶æ»¡è¶³ï¼‰ï¼š åˆ—è¡¨ä¸­æ‰€æœ‰å­—ç¬¦ä¸²å¯¹è±¡éƒ½ä¸è¶…è¿‡64å­—èŠ‚ã€‚ åˆ—è¡¨ä¸­å…ƒç´ æ•°é‡å°äº512ä¸ªã€‚ å¦‚æœä¸æ»¡è¶³åˆ™é‡‡ç”¨åŒç«¯é“¾è¡¨ï¼Œç¼–ç åªå¯èƒ½ç”±å‹ç¼©åˆ—è¡¨è½¬æ¢ä¸ºåŒç«¯é“¾è¡¨ï¼Œåæ–¹å‘åˆ™ä¸å¯èƒ½ã€‚ å“ˆå¸Œ 3.1 æ¦‚å†µ å“ˆå¸Œä¸ä»…æ˜¯Rediså¯¹å¤–æä¾›çš„5ç§å¯¹è±¡ç±»å‹çš„ä¸€ç§ï¼Œä¹Ÿæ˜¯Redisä½œä¸ºKey-Valueæ•°æ®åº“æ‰€ä½¿ç”¨çš„æ•°æ®ç»“æ„ã€‚ä¸ºæ–¹ä¾¿åŒºåˆ†ï¼Œâ€œå†…å±‚çš„å“ˆå¸Œâ€è¡¨ç¤ºrediså¯¹å¤–æä¾›çš„5ç§å¯¹è±¡ç±»å‹çš„ä¸€ç§ï¼Œâ€œå¤–å±‚çš„å“ˆå¸Œâ€è¡¨ç¤ºRedisä½œä¸ºKey-Valueæ•°æ®åº“ä½¿ç”¨çš„æ•°æ®ç»“æ„ã€‚ 3.2 å†…éƒ¨ç¼–ç  å†…å±‚çš„å“ˆå¸Œä½¿ç”¨çš„å†…éƒ¨ç¼–ç å¯ä»¥æ˜¯å‹ç¼©åˆ—è¡¨å’Œå“ˆå¸Œè¡¨ä¸¤ç§ï¼Œå¤–å±‚çš„å“ˆå¸Œåªä½¿ç”¨äº†å“ˆå¸Œè¡¨ã€‚ å‹ç¼©åˆ—è¡¨ç›¸è¾ƒäºå“ˆå¸Œè¡¨ï¼Œé€‚ç”¨äºå…ƒç´ ä¸ªæ•°å°‘ï¼Œå…ƒç´ é•¿åº¦å°çš„åœºæ™¯ï¼Œä¼˜åŠ¿åœ¨äºé›†ä¸­å­˜å‚¨ï¼ŒèŠ‚çœç©ºé—´ï¼›å½“å…ƒç´ è¾ƒå°‘æ—¶ï¼Œä¸å“ˆå¸Œè¡¨ç›¸æ¯”æ²¡æœ‰æ˜æ˜¾åŠ£åŠ¿ã€‚ å“ˆå¸Œè¡¨ï¼šä¸€ä¸ªå“ˆå¸Œè¡¨ç”±ä¸€ä¸ªdictç»“æ„ï¼Œä¸¤ä¸ªdicthtç»“æ„ï¼Œä¸€ä¸ªdictEntryæŒ‡é’ˆæ•°ç»„å’Œå¤šä¸ªdictEntryç»“æ„ç»„æˆï¼Œå¯è§ä¸‹å›¾ï¼š dictEntry dictEntryç”¨äºä¿å­˜é”®å€¼å¯¹ï¼Œç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š C++ typedef struct dictEntry{ void *key; union{ void *val; uint64_tu64; int64_ts64; }v; struct dictEntry *next; }dictEntry; â€¢ keyï¼šé”®ã€‚ â€¢ valï¼šå€¼ï¼ŒåŸºäºunionå®ç°ï¼Œå­˜å‚¨çš„å†…å®¹å¯èƒ½æ˜¯ï¼šä¸€ä¸ªæŒ‡å‘å€¼çš„æŒ‡é’ˆï¼Œ64ä½æ•´å‹ï¼Œæ— ç¬¦å·64ä½æ•´å‹ã€‚ â€¢ nextï¼šæŒ‡å‘çš„ä¸‹ä¸€ä¸ªdictEntryï¼Œä¸»è¦ç”¨äºè§£å†³å“ˆå¸Œå†²çªã€‚ åœ¨64ä½çš„æ“ä½œç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªdictEntryå¯¹è±¡å 24å­—èŠ‚ã€‚ bucket bucketæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå­˜å‚¨è¿™dictEntryç»“æ„çš„æŒ‡é’ˆã€‚bucketå¤§å°æŒ‰ç…§å¤§äºdictEntryçš„ã€æœ€å°çš„2^nçš„è§„åˆ™è®¡ç®—ã€‚ dictht dicthtç»“æ„å¦‚ä¸‹ï¼š C++ typedef struct dictht{ dictEntry **table; unsigned long size; unsigned long sizemask; unsigned long used; }dictht; â€¢ tableï¼šæŒ‡é’ˆï¼ŒæŒ‡å‘bucketã€‚ â€¢ sizeï¼šè®°å½•bucketçš„å¤§å°ã€‚ â€¢ sizemaskï¼šsize-1ã€‚ â€¢ usedï¼šè®°å½•å·²ä½¿ç”¨çš„dictEntryæ•°é‡ã€‚ dict ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨dicthtå’ŒdictEntryå·²ç»è¶³å¤Ÿå®ç°å“ˆå¸Œè¡¨çš„åŠŸèƒ½ï¼Œä½†åœ¨Rediså®ç°ä¸­ï¼Œdicthtä¸Šå±‚è¿˜å­˜åœ¨dictç»“æ„ï¼Œdictç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š C++ typedef struct dict{ dictType *type; void *privdata; dictht ht[2]; int trehashidx; } dict; â€¢ typeï¼šdictTypeå®šä¹‰äº†ä¸€ç°‡ç”¨äºæ“ä½œç‰¹å®šç±»å‹é”®å€¼å¯¹çš„å‡½æ•°ã€‚ â€¢ privdataï¼š â€¢ ht[2]ï¼šå­—å…¸çš„æ ¸å¿ƒï¼ŒåŒ…å«ä¸¤ä¸ªdicthtç»“æ„çš„æ•°ç»„ã€‚ä½¿ç”¨ä¸¤ä¸ªå“ˆå¸Œè¡¨çš„ç›®çš„æ˜¯æ”¯æŒæ¸è¿›å¼rehashã€‚ ï¿® ht[0]ï¼šå¹³æ—¶ä½¿ç”¨çš„å“ˆå¸Œè¡¨ã€‚ ï¿® ht[1]ï¼šä»…åœ¨rehashè¿‡ç¨‹ä¸­ä½¿ç”¨ã€‚ â€¢ trehashidxï¼šç”¨äºæŒ‡ç¤ºå½“å‰æ˜¯å¦åœ¨è¿›è¡Œrehashã€‚-1è¡¨ç¤ºæ²¡æœ‰è¿›è¡Œrehashæ“ä½œï¼Œé-1è¡¨ç¤ºæ­£åœ¨è¿›è¡Œï¼Œå…¶å€¼è¡¨ç¤ºä¸‹ä¸€ä¸ªéœ€è¦ä»ht[0]è¿ç§»åˆ°ht[1]çš„å“ˆå¸Œè¡¨æ•°ç»„ç´¢å¼•ã€‚ å½“ht[0]çš„è´Ÿè½½å› å­è¶…è¿‡æŸä¸ªé˜ˆå€¼æ—¶ï¼Œå­—å…¸éœ€è¦æ‰©å®¹ä»¥é¿å…å“ˆå¸Œå†²çªè¿‡äºé¢‘ç¹ï¼Œè¿™æ—¶Redisä¼šåˆ†é…ä¸€ä¸ªæ›´å¤§çš„ht[1]ï¼ˆé€šå¸¸æ˜¯ht[0]çš„ä¸¤å€ï¼‰ï¼Œä¹‹åå°† rehashidx è®¾ç½®ä¸º 0ï¼Œè¡¨ç¤ºå¼€å§‹ rehashã€‚åœ¨åç»­çš„æ¯æ¬¡å­—å…¸æ“ä½œï¼ˆå¦‚ dictAdd, dictFind, dictDelete ç­‰ï¼‰ä¸­ï¼Œé™¤äº†æ‰§è¡ŒæŒ‡å®šçš„æ“ä½œå¤–ï¼Œè¿˜ä¼šé¡ºå¸¦å°† ht[0] ä¸­ rehashidx ç´¢å¼•ä¸Šçš„æ‰€æœ‰ dictEntry è¿ç§»åˆ° ht[1]ã€‚è¿ç§»å®Œæˆåï¼Œrehashidx è‡ªå¢ã€‚å½“æ‰€æœ‰ ht[0] çš„æ•°æ®éƒ½è¿ç§»åˆ° ht[1] åï¼Œht[0] å’Œ ht[1] äº’æ¢è§’è‰²ï¼Œht[1] å˜ä¸ºæ–°çš„ç©ºå“ˆå¸Œè¡¨ï¼Œrehashidx è®¾ä¸º -1ï¼Œè¡¨ç¤º rehash ç»“æŸã€‚ 3.3 ç¼–ç è½¬æ¢ å†…å±‚çš„å“ˆå¸Œå¯ä½¿ç”¨å‹ç¼©åˆ—è¡¨ä¹Ÿå¯ä½¿ç”¨å“ˆå¸Œè¡¨ã€‚ã€ ä½¿ç”¨å‹ç¼©åˆ—è¡¨éœ€æ»¡è¶³çš„æ¡ä»¶å¦‚ä¸‹ï¼š å“ˆå¸Œä¸­å…ƒç´ æ•°é‡å°äº512ä¸ªï¼› å“ˆå¸Œä¸­æ‰€æœ‰é”®å€¼å¯¹çš„é”®å’Œå€¼å­—ç¬¦ä¸²é•¿åº¦éƒ½å°äº64å­—èŠ‚ã€‚ ä»»ä½•ä¸€é¡¹ä¸æ»¡è¶³åˆ™ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œç¼–ç åªå¯èƒ½ä»å‹ç¼©åˆ—è¡¨è½¬æ¢ä¸ºå“ˆå¸Œè¡¨ã€‚ é›†åˆ 4.1 æ¦‚å†µ é›†åˆï¼ˆsetï¼‰ä¸åˆ—è¡¨ç±»ä¼¼ï¼Œéƒ½æ˜¯ç”¨æ¥ä¿å­˜å¤šä¸ªå­—ç¬¦ä¸²ï¼Œä½†é›†åˆä¸åˆ—è¡¨æœ‰ä¸¤ç‚¹ä¸åŒï¼šé›†åˆä¸­çš„å…ƒç´ æ˜¯æ— åºçš„ï¼Œå› æ­¤ä¸èƒ½é€šè¿‡ç´¢å¼•æ¥æ“ä½œå…ƒç´ ï¼›é›†åˆä¸­çš„å…ƒç´ ä¸èƒ½é‡å¤ã€‚ ä¸€ä¸ªé›†åˆä¸­æœ€å¤šå¯ä»¥å­˜å‚¨2^32-1ä¸ªå…ƒç´ ï¼›é™¤äº†æ”¯æŒå¸¸è§„çš„å¢åˆ æ”¹æŸ¥ï¼ŒRedisè¿˜æ”¯æŒå¤šä¸ªé›†åˆå–äº¤é›†ã€å¹¶é›†ã€å·®é›†ã€‚ 4.2 å†…éƒ¨ç¼–ç  é›†åˆçš„å†…éƒ¨ç¼–ç å¯ä»¥æ˜¯æ•´æ•°é›†åˆï¼ˆintsetï¼‰æˆ–å“ˆå¸Œè¡¨ï¼ˆhashtableï¼‰ã€‚å“ˆå¸Œè¡¨å‰é¢å·²ç»æåˆ°ï¼Œä¸‹é¢ä»‹ç»æ•´æ•°é›†åˆã€‚ æ•´æ•°é›†åˆçš„ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š C++ typedef struct intset{ uint32_t encoding; uint32_t length; int8_t contents[]; } intset; â€¢ encodingï¼šè®°å½•contentsæ•°ç»„ä¸­å…ƒç´ çš„ç¼–ç æ–¹å¼ï¼Œå®ƒå†³å®šäº†æ¯ä¸ªå…ƒç´ å ç”¨çš„å­—èŠ‚æ•°ã€‚Redisæ”¯æŒä¸‰ç§ç¼–ç ï¼š ï¿® INTSET_ENC_INT16 â–ª æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª 16 ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆint16_tï¼‰ã€‚ â–ª å½“é›†åˆä¸­æ‰€æœ‰å…ƒç´ éƒ½åœ¨è¿™ä¸ªèŒƒå›´å†…æ—¶ï¼Œä½¿ç”¨æ­¤ç¼–ç ã€‚ ï¿® INTSET_ENC_INT32 â–ª æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª 32 ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆint32_tï¼‰ã€‚ â–ª å½“é›†åˆä¸­å‡ºç°è¶…å‡ºint16_tèŒƒå›´ï¼Œä½†ä»åœ¨int32_tèŒƒå›´å†…çš„å…ƒç´ æ—¶ï¼Œä¼šè§¦å‘ â€œå‡çº§â€ï¼Œå°†æ‰€æœ‰å…ƒç´ éƒ½è½¬æ¢ä¸ºint32_tç¼–ç ã€‚ ï¿® INTSET_ENC_INT64 â–ª æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª 64 ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆint64_tï¼‰ã€‚ â–ª å½“é›†åˆä¸­å‡ºç°è¶…å‡º int32_t èŒƒå›´çš„å…ƒç´ æ—¶ï¼Œä¼šå†æ¬¡è§¦å‘å‡çº§ï¼Œå°†æ‰€æœ‰å…ƒç´ è½¬æ¢ä¸ºint64_tç¼–ç ã€‚ â€¢ lengthï¼šè¡¨ç¤ºå…ƒç´ ä¸ªæ•°ã€‚ â€¢ contents[]ï¼šå®é™…å­˜å‚¨çš„ç±»å‹æ˜¯int16_tã€int32_tã€int64_tï¼Œç”±encodingå†³å®šã€‚ 4.3 ç¼–ç è½¬æ¢ ä½¿ç”¨æ•´æ•°é›†åˆéœ€åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š é›†åˆä¸­å…ƒç´ æ•°é‡å°äº512ã€‚ é›†åˆä¸­æ‰€æœ‰å…ƒç´ éƒ½æ˜¯æ•´æ•°å€¼ã€‚ ä»»ä½•ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³åˆ™ä½¿ç”¨å“ˆå¸Œè¡¨ï¼Œåªå¯èƒ½èƒ½ä»æ•´æ•°é›†åˆè½¬æ¢ä¸ºå“ˆå¸Œè¡¨ï¼Œåæ–¹å‘åˆ™ä¸å¯èƒ½ã€‚ æœ‰åºé›†åˆ 5.1 æ¦‚å†µ æœ‰åºé›†åˆä¸é›†åˆä¸€æ ·ï¼Œå…ƒç´ ä¸èƒ½é‡å¤ï¼Œä½†å…ƒç´ æ˜¯æœ‰åºçš„ï¼Œå…¶æ’åºæ–¹å¼å–å†³äºæ¯ä¸ªå…ƒç´ çš„åˆ†æ•°ã€‚ 5.2 å†…éƒ¨ç¼–ç  æœ‰åºé›†åˆçš„å†…éƒ¨ç¼–ç å¯ä»¥æ˜¯å‹ç¼©åˆ—è¡¨ï¼ˆziplistï¼‰æˆ–è·³è·ƒè¡¨ï¼ˆskiplistï¼‰ã€‚ziplistå‰é¢å·²ç»æåˆ°è¿‡ï¼Œè¿™é‡Œä¸»è¦ä»‹ç»è·³è·ƒè¡¨ã€‚ è·³è·ƒè¡¨æ˜¯ä¸€ç§æœ‰åºæ•°æ®ç»“æ„ï¼Œé€šè¿‡åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸­ç»´æŒå¤šä¸ªæŒ‡å‘å…¶ä»–èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œä»è€Œè¾¾åˆ°å¿«é€Ÿè®¿é—®èŠ‚ç‚¹çš„ç›®çš„ã€‚é™¤äº†è·³è·ƒè¡¨ï¼Œå®ç°æœ‰åºæ•°æ®ç»“æ„çš„å¦ä¸€ç§å…¸å‹å®ç°æ˜¯å¹³è¡¡æ ‘ï¼Œä½†å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè·³è·ƒè¡¨çš„æ•ˆç‡å¯ä»¥å’Œå¹³è¡¡æ ‘åª²ç¾ï¼Œä¸”è·³è·ƒè¡¨å®ç°æ¯”å¹³è¡¡æ ‘ç®€å•å¾ˆå¤šï¼Œå› æ­¤redisä¸­é€‰ç”¨è·³è·ƒè¡¨ä»£æ›¿å¹³è¡¡æ ‘ã€‚è·³è·ƒè¡¨æ”¯æŒå¹³å‡O(logN)ã€æœ€åO(N)çš„å¤æ‚ç‚¹è¿›è¡ŒèŠ‚ç‚¹æŸ¥æ‰¾ï¼Œå¹¶æ”¯æŒé¡ºåºæ“ä½œã€‚Redisçš„è·³è·ƒè¡¨å®ç°ç”±zskiplistå’ŒzskiplistNodeä¸¤ä¸ªç»“æ„ç»„æˆï¼šå‰è€…ç”¨äºä¿å­˜è·³è·ƒè¡¨ä¿¡æ¯ï¼ˆå¦‚å¤´ç»“ç‚¹ã€å°¾èŠ‚ç‚¹ã€é•¿åº¦ç­‰ï¼‰ï¼Œåè€…ç”¨äºè¡¨ç¤ºè·³è·ƒè¡¨èŠ‚ç‚¹ã€‚ 5.3 ç¼–ç è½¬æ¢ ä½¿ç”¨å‹ç¼©åˆ—è¡¨éœ€åŒæ—¶æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š æœ‰åºé›†åˆä¸­å…ƒç´ æ•°é‡å°äº128ä¸ªã€‚ æœ‰åºé›†åˆä¸­æ‰€æœ‰æˆå‘˜é•¿åº¦éƒ½ä¸è¶³64å­—èŠ‚ã€‚ å¦‚æœæœ‰ä¸€ä¸ªæ¡ä»¶ä¸æ»¡è¶³ï¼Œåˆ™ä½¿ç”¨è·³è·ƒè¡¨ï¼Œä¸”ç¼–ç åªå¯èƒ½ç”±å‹ç¼©åˆ—è¡¨è½¬åŒ–ä¸ºè·³è·ƒè¡¨ï¼Œåæ–¹å‘åˆ™ä¸å¯èƒ½ã€‚","link":"/2025/11/09/java/Redis/"},{"title":"èµ›å°”å·é€†å‘ï¼šå°åŒ…åˆ†æ","text":"æ–‡ç« å†…å®¹å®Œå–„ä¸­â€¦â€¦ å‰è¨€ä½œè€…æ˜¯ä¸€åèµ›å°”å·PVPç©å®¶ï¼Œæœ€è¿‘èƒœç‡ä¸€ç›´ä¸é«˜ï¼Œå› æ­¤å†³å®šåˆ¶ä½œä¸€æ¬¾å·…å³°è¾…åŠ©å·¥å…·ã€‚ æœ¬äººæ­¤å‰ä»æœªæ¥è§¦è¿‡ç½‘ç»œé€šä¿¡è¿™ä¸€å—ï¼ŒåŸºæœ¬æ˜¯ç°å­¦ç°ç”¨ï¼Œå› æ­¤å¯èƒ½ä¼šå­˜åœ¨éƒ¨åˆ†é—®é¢˜ï¼Œè¿˜æœ›å¤§ä½¬ä»¬æŒ‡å‡ºï¼ æœ¬æ–‡æ‰€ç”¨å·¥å…·å¦‚ä¸‹ï¼š å·¥å…· æè¿° Fiddler Classic æŠ“åŒ…å·¥å…· JPEXS Free Flash Decompiler Flashæ–‡ä»¶åç¼–è¯‘å·¥å…· x64dbg ç¨‹åºè°ƒè¯•å™¨ é¡¹ç›®å¼€æºåœ°å€ï¼šhttps://github.com/dauphinYan/SeerAssistant è·å–Flashæ–‡ä»¶å¹¶åç¼–è¯‘æœ¬é˜¶æ®µç”¨åˆ°çš„å·¥å…·ï¼šFiddler Classicã€JPEXS Free Flash Decompilerã€‚ è¿™éƒ¨åˆ†æš‚æ—¶è·³è¿‡â€¦ï¼ˆå¯ä»¥å‚è€ƒæ–‡æœ«é“¾æ¥ï¼‰ åç¼–è¯‘æˆåŠŸåï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸‹è¿°å››ä¸ªæ–‡ä»¶å¤¹ï¼š 1234ClientRobotAppDLLRobotCoreDLLTaomeeLibrary å°è¯•è¯»æºç ï¼é€šä¿¡æ•°æ®è§£å¯†æˆ‘ä»¬å¯ä»¥åœ¨å‰é¢åç¼–è¯‘å¾—åˆ°çš„TaomeeLibraryæ–‡ä»¶å¤¹ä¸­æœç´¢socketï¼Œæ¯•ç«Ÿç½‘ç»œé€šä¿¡éƒ½éœ€è¦ä½¿ç”¨åˆ°socketï¼Œæ‰€ä»¥å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹æ³•å¿«é€Ÿæ¥è¿‘ç›®æ ‡ã€‚ç„¶åï¼Œæˆ‘ä»¬å‘ç°äº†ååˆ†æ˜¾çœ¼çš„MDecrypt.asï¼Œèµ¶å¿«è¿›å»ç§ç§ï¼ å¯ä»¥çœ‹åˆ°MDecrypt.asçš„ä¸»è¦å‡½æ•°ä¸ºï¼š 1public function MDecrypt(param1:ByteArray, param2:int, param3:ByteArray) : void å› æ­¤æˆ‘ä»¬éœ€è¦å¼„æ¸…ä¼ å…¥çš„ä¸‰ä¸ªå‚æ•°å¯¹åº”çš„å«ä¹‰ã€‚ åŒæ ·ï¼Œåœ¨TameeLibraryæ–‡ä»¶å¤¹ä¸­æœç´¢MDecrypt(ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæŠ€å·§ï¼Œåœ¨æœ«å°¾æ·»åŠ (å°±å¯ä»¥å¿«é€Ÿæ‰¾åˆ°è¯¥å‡½æ•°åœ¨å“ªé‡Œå®ç°ä»¥åŠè°ƒç”¨ã€‚ ç°åœ¨å¯ä»¥æ¸…æ¥šçš„çœ‹åˆ°åœ¨MessageEncrypt.asä¸­æœ‰è°ƒç”¨ï¼Œæˆ‘ä»¬è¿›å»çœ‹çœ‹ã€‚ 12345678910111213private static var NO_ENCRYPT_LEN:int = 4; public static function decrypt(inData:ByteArray) : ByteArray { var inLen:int = inData.readUnsignedInt() - NO_ENCRYPT_LEN; var outData:ByteArray = new ByteArray(); outData.writeUnsignedInt(0); MDecrypt(inData,inLen,outData); outData.position = 0; outData.writeUnsignedInt(outData.length); outData.position = 0; return outData; } é€šè¿‡è¿™ä¸ªå‡½æ•°å®ç°ï¼Œå¯ä»¥å¤§èƒ†çŒœæµ‹ï¼š InDataï¼šä¼ å…¥çš„æ•°æ®åŒ…ã€‚ inLenï¼šçœŸæ­£éœ€è¦è§£å¯†çš„éƒ¨åˆ†ã€‚ outDataï¼šè§£å¯†åçš„æ•°æ®åŒ…ã€‚ NO_ENCRYPT_LENï¼šè®°å½•æ•°æ®åŒ…çš„é•¿åº¦ä¿¡æ¯ã€‚ï¼ˆè¿™é‡Œå¤§èƒ†çŒœæµ‹ï¼Œå‰å››å­—èŠ‚ä¸ºåŒ…ä½“é•¿åº¦ï¼‰ ä¸ºä»€ä¹ˆè¿™ä¹ˆçŒœæµ‹å‘¢ï¼Ÿå› ä¸ºæ•°æ®åœ¨ä¼ é€’çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®ä¸æ˜¯é€å­—èŠ‚çš„å‘é€çš„ï¼Œè€Œæ˜¯ä»¥æ•°æ®åŒ…çš„å½¢å¼æˆæ‰¹å‘é€ï¼Œé‚£ä¹ˆå‘é€æ–¹ä¸ºäº†è®©æ¥æ”¶æ–¹åŒºåˆ†æ¥æ”¶åˆ°çš„æ•°æ®ï¼Œé€šå¸¸ä¼šåœ¨æ•°æ®åŒ…å¤´éƒ¨ä¿ç•™æ˜æ–‡ç‰‡æ®µç”¨äºæ ‡è¯†æ•°æ®åŒ…çš„é•¿åº¦ã€‚ MDecrypt.asæºç å¯è¯»æ€§æ¯”è¾ƒå·®ï¼Œæœ‰å…´è¶£å¯ä»¥è‡ªè¡Œé˜…è¯»åˆ†æï¼Œä½¿ç”¨C++é‡å†™çš„æºç å¯è§ä¸‹æ–¹ã€‚ C++é‡å†™åçš„è§£å¯†æºç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142std::vector&lt;uint8_t&gt; Cryptor::Decrypt(const std::vector&lt;uint8_t&gt; &amp;Cipher){ size_t len = Cipher.size(); if (len == 0 || Key.empty()) return {}; // è®¡ç®—æ—‹è½¬é‡ int result = Key[(len - 1) % Key.size()] * 13 % len; // ç¯å½¢å³ç§» result ä¸ªå­—èŠ‚ std::vector&lt;uint8_t&gt; rotated = Merge( Slice(Cipher, len - result, len), Slice(Cipher, 0, len - result)); // å³ç§»/å·¦ç§»ç»„åˆæ¢å¤åŸå§‹å­—èŠ‚åºåˆ—ï¼ˆå»æ‰æœ€åä¸€ä¸ªå­—èŠ‚ï¼‰ std::vector&lt;uint8_t&gt; plain(len - 1); for (size_t i = 0; i &lt; len - 1; ++i) { plain[i] = static_cast&lt;uint8_t&gt;((rotated[i] &gt;&gt; 5) | (rotated[i + 1] &lt;&lt; 3)); } // å¼‚æˆ–è§£å¯† size_t j = 0; bool NeedBecomeZero = false; for (size_t i = 0; i &lt; plain.size(); ++i) { if (j == 1 &amp;&amp; NeedBecomeZero) { j = 0; NeedBecomeZero = false; } if (j == Key.size()) { j = 0; NeedBecomeZero = true; } plain[i] = static_cast&lt;uint8_t&gt;(plain[i] ^ Key[j]); ++j; } return plain;} ä¸è¿‡æœ‰ä¸€ç‚¹éœ€è¦æ³¨æ„ï¼Œåœ¨å®˜æ–¹çš„æºç ä¸­ 1_loc11_ = CModule.mallocString(getDefinitionByName(&quot;com.robot.core.net.SocketConnection&quot;).key); _loc11_åœ¨å¾ˆå¤šå¤„éƒ½æœ‰å‚ä¸è¿ç®—ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å¼„æ¸…æ¥šè¿™ä¸ªå€¼æ˜¯æ€ä¹ˆæ¥çš„ã€‚ æ ¹æ®è·¯å¾„æ‰¾åˆ°SocketConnection.asï¼Œå‘ç°å…³é”®å‡½æ•°key()ï¼š 1234567891011121314151617181920212223private static var _encryptKeyStringArr:Array;public static function get key() : String{ var _loc2_:int = 0; var _loc3_:String = null; var _loc1_:String = &quot;&quot;; if(_encryptKeyStringArr == null) { _loc1_ = &quot;!crAckmE4nOthIng:-)&quot;; } else { _loc2_ = 0; while(_loc2_ &lt; _encryptKeyStringArr.length) { _loc3_ = StringUtil.replace(_encryptKeyStringArr[_loc2_],&quot;*&quot;,&quot;&quot;); _loc1_ += _loc3_; _loc2_++; } } return _loc1_;} ä¸éš¾çŸ¥é“ï¼Œé»˜è®¤æƒ…å†µä¸‹keyçš„å€¼ä¸º!crAckmE4nOthIng:-)ï¼Œè¿™ä¸ªå¯†é’¥çœ‹ç€å¾ˆåƒæŸäº›å•è¯çš„ç¼©å†™ï¼Œç®€å•è§£è¯»ä¸€ä¸‹ã€‚ crAckmEï¼šCrack me. 4ï¼šfor. nOthIngï¼šNothing. è¿èµ·æ¥ä¹Ÿå°±æ˜¯ï¼š 1Crack me for nothing. è¯•ç€ç ´è§£æˆ‘å§ï¼Œåæ­£ä¹Ÿæ²¡å•¥æœ‰ç”¨çš„ä¸œè¥¿ğŸ˜Š è¿™é‡Œæ„Ÿè°¢â€åœ†åœ†åœ†â€œæä¾›çš„è§£é‡Šã€‚ æ˜¾ç„¶ï¼Œè¿™ä¸ªkeyåœ¨åé¢è‚¯å®šä¼šè¢«ä¿®æ”¹ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­åˆæ‰¾åˆ°çš„ä¿®æ”¹å‡½æ•°ï¼š 1234public static function setEncryptKeyStringArr(param1:Array) : void{ _encryptKeyStringArr = param1;} å› æ­¤åœ¨æ–‡ä»¶å¤¹ä¸­æœç´¢setEncryptKeyStringArr(ï¼Œå¾—åˆ°ç»“æœå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åªæ‰¾åˆ°ä¸€å¤„è¯¥æ–¹æ³•çš„è°ƒç”¨ï¼Œå’Œæˆ‘ä»¬çš„é¢„æœŸæœ‰æ‰€å·®è·ï¼š 123456789101112131415161718192021222324252627282930private static function onSocketClose(param1:Event) : void{ var event:Event = param1; DebugTrace.show(&quot;////////////////////////////////////////////////////////////////////////////////\\r//\\r//\\t\\t\\t\\t&quot; + &quot;socket was closed\\r//\\r////////////////////////////////////////////////////////////////////////////////&quot;); try { SocketConnection.mainSocket.removeEventListener(Event.CLOSE,onSocketClose); SocketConnection.setEncryptKeyStringArr(null); SocketConnectionHelper.clear(); ModuleManager.hideAllModule(); if(login10004) { return; } Alarm.show(&quot;æ­¤æ¬¡è¿æ¥å·²ç»æ–­å¼€ï¼Œè¯·é‡æ–°ç™»å½•&quot;,function():void { if(ExternalInterface.available) { navigateToURL(new URLRequest(&quot;javascript:window.location.reload();&quot;),&quot;_self&quot;); } else { navigateToURL(new URLRequest(&quot;https://seer.61.com&quot;),&quot;_self&quot;); } },false,true,false,LevelManager.stage); } catch(e:Error) { }} å¯ä»¥çœ‹åˆ°è¿™éƒ¨åˆ†å‘ç”Ÿåœ¨ä¸æ¸¸æˆæœåŠ¡å™¨æ–­å¼€çš„é˜¶æ®µï¼Œå¹¶æ²¡æœ‰è¾¾åˆ°ä¿®æ”¹keyçš„ç›®çš„ï¼Œç°åœ¨å°±æ¯”è¾ƒéº»çƒ¦äº†ã€‚ æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£æˆ‘ä»¬å…ˆå»å¼€ä¸€æŠŠä¼‘æ¯ä¸€ä¸‹ï¼Œç¾ç»Šåçš„ä¼½é©¬å¼ºåº¦è¿˜æ˜¯å¤ªçˆ†ç‚¸äº†â€¦â€¦ æ•°æ®åŒ…æ ¼å¼è§£æåœ¨æ‰¾keyä¹‹å‰å‘¢ï¼Œå¯ä»¥å…ˆçœ‹çœ‹å®˜æ–¹æ˜¯å¦‚ä½•è§£ææ•°æ®åŒ…çš„ï¼Œå‰é¢æˆ‘ä»¬çŸ¥é“MessageEncrypt.asæœ‰ä¸€ä¸ªdecrypt(å‡½æ•°ï¼Œå¾ˆæ˜æ˜¾ï¼Œè¿™æ˜¯ä¸€ä¸ªå¥—å£³å‡½æ•°ï¼Œæ²¡æœ‰è§£ææ•°æ®çš„å…·ä½“å®ç°ã€‚å› æ­¤æ–‡ä»¶å¤¹ä¸­æœç´¢decrypt(ï¼Œå¯ä»¥å®šä½åˆ°SocketEncryptImpl.asï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªå‡½æ•°ï¼š 12345678910111213141516171819202122232425262728293031323334353637private function onData(e:Event) : void{ var msgLen:int = 0; var ba:ByteArray = null; DebugTrace.show(&quot;socket onData handler....................&quot;); this._chunkBuffer.clear(); if(this._tempBuffer.length &gt; 0) { this._tempBuffer.position = 0; this._tempBuffer.readBytes(this._chunkBuffer,0,this._tempBuffer.length); this._tempBuffer.clear(); } readBytes(this._chunkBuffer,this._chunkBuffer.length,bytesAvailable); this._chunkBuffer.position = 0; while(this._chunkBuffer.bytesAvailable &gt; 0) { if(this._chunkBuffer.bytesAvailable &gt; MSG_FIRST_TOKEN_LEN) { msgLen = this._chunkBuffer.readUnsignedInt() - MSG_FIRST_TOKEN_LEN; if(this._chunkBuffer.bytesAvailable &gt;= msgLen) { this._chunkBuffer.position -= MSG_FIRST_TOKEN_LEN; ba = MessageEncrypt.decrypt(this._chunkBuffer); // åœ¨è¿™é‡Œï¼ this.parseData(ba); } else { this._chunkBuffer.position -= MSG_FIRST_TOKEN_LEN; this._chunkBuffer.readBytes(this._tempBuffer,0,this._chunkBuffer.bytesAvailable); } } else { this._chunkBuffer.readBytes(this._tempBuffer,0,this._chunkBuffer.bytesAvailable); } }} åœ¨è§£å¯†å‡½æ•°çš„ä¸‹æ–¹ï¼Œæœ‰ä¸€ä¸ªParseDataå‡½æ•°ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯â€è§£ææ•°æ®â€œã€‚é‚£ä¹ˆæˆ‘ä»¬å®šä½åˆ°é‚£é‡Œå»ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142private static const HEAD_LENGTH:uint = 17;private function parseData(data:ByteArray) : void { var info:ByteArray = null; var tmfClass:Class = null; this._packageLen = data.readUnsignedInt(); if(this._packageLen &lt; HEAD_LENGTH || this._packageLen &gt; PACKAGE_MAX) { this.readDataError(0); dispatchEvent(new SocketErrorEvent(SocketErrorEvent.ERROR,null)); data.readBytes(new ByteArray()); return; } this._headInfo = new HeadInfo(data); if(this._headInfo.cmdID == 1001) { this._result = this._headInfo.result; } DebugTrace.show(&quot;&lt;&lt;Socket[&quot; + this.ip + &quot;:&quot; + this.port.toString() + &quot;][cmdID:&quot; + this._headInfo.cmdID + &quot;]&quot;,getCmdLabel(this._headInfo.cmdID)); if(this._headInfo.result &gt; 1000) { this.readDataError(this._headInfo.cmdID); this.dispatchError(this._headInfo.cmdID,this._headInfo); dispatchEvent(new SocketErrorEvent(SocketErrorEvent.ERROR,this._headInfo)); return; } this._dataLen = this._packageLen - HEAD_LENGTH; if(this._dataLen == 0) { this.readDataError(this._headInfo.cmdID); this.dispatchCmd(this._headInfo.cmdID,this._headInfo,null); } else { info = new ByteArray(); data.readBytes(info,0,this._dataLen); tmfClass = TMF.getClass(this._headInfo.cmdID); this.readDataError(this._headInfo.cmdID); this.dispatchCmd(this._headInfo.cmdID,this._headInfo,new tmfClass(info)); } } å¯ä»¥çœ‹åˆ°ï¼ŒDebugè¾“å‡ºä¸_headInfoæœ‰å…³ï¼Œé‚£ä¹ˆåŒæ ·çš„æ–¹å¼ï¼Œæˆ‘ä»¬å®šä½åˆ°HeadInfo 12345678public function HeadInfo(headData:IDataInput){ super(); this._version = headData.readUTFBytes(1); // ç‰ˆæœ¬å·ï¼Œ1å­—èŠ‚ this._cmdID = headData.readUnsignedInt(); // å‘½ä»¤å·ï¼Œ4å­—èŠ‚ this._userID = headData.readUnsignedInt(); // ç”¨æˆ·å·ï¼Œ4å­—èŠ‚ this._result = headData.readInt(); // åºåˆ—å·ï¼Œ4å­—èŠ‚} å†æ¬¡é˜…è¯»ä»£ç ï¼Œç°åœ¨å°åŒ…çš„ç»“æ„å°±ååˆ†æ˜ç¡®äº†ï¼š 1234567// å°åŒ…é•¿åº¦, 4å­—èŠ‚|ç‰ˆæœ¬å·ï¼Œ1å­—èŠ‚|å‘½ä»¤å·ï¼Œ4å­—èŠ‚|ç”¨æˆ·å·ï¼Œ4å­—èŠ‚|åºåˆ—å·ï¼Œ4å­—èŠ‚|åŒ…ä½“æ•°æ®this._packageLen = data.readUnsignedInt(); // å°åŒ…é•¿åº¦, 4å­—èŠ‚this._headInfo = new HeadInfo(data); // å¤´éƒ¨ä¿¡æ¯ï¼Œ13å­—èŠ‚this._dataLen = this._packageLen - HEAD_LENGTH; // åŒ…ä½“é•¿åº¦ è¿™é‡Œè¡¥å……ä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¼šå‘ç°åœ¨parseData()å‡½æ•°ä¸­ï¼Œæœ‰ä¸€å¤„å‘½ä»¤IDçš„åˆ¤æ–­ï¼š 1234if(this._headInfo.cmdID == 1001){ this._result = this._headInfo.result;} å¯ä»¥å°è¯•åœ¨æ–‡ä»¶å¤¹ä¸­æœç´¢cmdIDï¼Œæ¥ç€æˆ‘ä»¬ä¼šå‘ç°ï¼š è¿™é‡Œæœ‰ä¸€ä¸ªcmdIDçš„å€¼ä¸º41129ï¼Œæ¥ç€æˆ‘ä»¬ç»§ç»­æœç´¢41129ï¼Œç„¶åæˆ‘ä»¬ä¼šæ‰¾åˆ°CommandID.asæ–‡ä»¶å¤¹ï¼Œè¿™é‡Œé¢å°±åŒ…å«äº†æ‰€æœ‰å‘½ä»¤çš„IDï¼Œä¸‹é¢æˆªå–éƒ¨åˆ†å†…å®¹ï¼š 1234567891011121314151617181920package com.robot.core{ public class CommandID { public static const LOADING_TIME_STAT:uint = 9303; public static const GET_PET_TOWER_ACHIEVE:uint = 3453; public static const RECEIVE_PRANKSTER_REWARD:uint = 1014; public static const TOPFIGHT_RANKING_LIST:uint = 2459; public static const TOPFIGHT_GET_AWARD:uint = 9374; public static const TOPFIGHT_WEEK_WIN:uint = 2532; public static const TOPFIGHT_BEYOND:uint = 2567; }} æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶çš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œè¿™é‡Œåªåˆ—ä¸¾å…¶ä¸­ä¸€ç§ï¼Œæœ€å¼€å§‹æ‰¾åˆ°è¿™ä¸ªæ–‡ä»¶çš„æ–¹æ³•æˆ‘å¿˜è®°äº†ï¼Œä¸Šè¿°æ–¹æ³•æ˜¯ä¸´æ—¶æ‰¾çš„ã€‚ æ‰¾å‡ºä¿®æ”¹Keyçš„ä½ç½®å›åˆ°è¿™é‡Œï¼Œæ—¢ç„¶æ‰¾ä¸åˆ°ä¿®æ”¹keyçš„ä½ç½®ï¼Œæˆ‘ä»¬ä¸å¦¨å…ˆä½¿ç”¨å½“å‰å·²ç»å¾—åˆ°çš„è§£å¯†ç®—æ³•å¯¹æ¥æ”¶åˆ°çš„æ•°æ®è¿›è¡Œè§£å¯†ï¼Œè¿™é‡Œé€‰ç”¨Hookæ³¨å…¥çš„æ–¹æ³•ï¼ˆç°åœ¨ä¸æ¸…æ¥šä¸ç”¨ç€æ€¥ï¼Œåé¢ä¼šä»‹ç»çš„ï¼‰ï¼Œè§£å¯†å¾—åˆ°çš„ä¿¡æ¯å¦‚ä¸‹ï¼š 1234567891011121314151617181920[2025-07-03 15:22:54.849] [ThreadID 0xfb8] [Temp] [Hooked send] Parsed Data:[Length=17 Version=49 CmdID=111 Cmd=â€”â€”â€”â€” UserID=123456789 SN=0 BodySize=0] [2025-07-03 15:22:54.874] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=21 Version=0 CmdID=111 Cmd=â€”â€”â€”â€” UserID=123456789 SN=0 BodySize=4] Body=[00 00 00 00 ][2025-07-03 15:22:54.878] [ThreadID 0xfb8] [Temp] [Hooked send] Parsed Data:[Length=37 Version=49 CmdID=109 Cmd=SYS_ROLE UserID=123456789 SN=0 BodySize=20] Body=[a4 0e a7 cc 84 21 87 f2 f6 91 51 9a 7a 0e b7 6e ...][2025-07-03 15:22:54.903] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=21 Version=0 CmdID=109 Cmd=SYS_ROLE UserID=123456789 SN=0 BodySize=4] Body=[00 00 00 00 ][2025-07-03 15:22:54.905] [ThreadID 0xfb8] [Temp] [Hooked send] Parsed Data:[Length=37 Version=49 CmdID=105 Cmd=COMMEND_ONLINE UserID=123456789 SN=0 BodySize=20] Body=[a4 0e a7 cc 84 21 87 f2 f6 91 51 9a 7a 0e b7 6e ...][2025-07-03 15:22:54.934] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=561 Version=0 CmdID=105 Cmd=COMMEND_ONLINE UserID=123456789 SN=0 BodySize=544] Body=[00 00 0b 99 00 00 00 03 00 79 ec 33 00 00 00 02 ...][2025-07-03 15:23:06.439] [ThreadID 0xfb8] [Temp] [Hooked send] Parsed Data:[Length=141 Version=49 CmdID=1001 Cmd=LOGIN_IN UserID=123456789 SN=202 BodySize=124] Body=[a4 0e a7 cc 84 21 87 f2 f6 91 51 9a 7a 0e b7 6e ...][2025-07-03 15:23:06.989] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=171 Version=62 CmdID=8002 Cmd=SYSTEM_MESSAGE UserID=123456789 SN=0 BodySize=154] Body=[00 01 88 43 68 66 2f da 00 00 00 8e 20 e7 b2 be ...][2025-07-03 15:23:06.995] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=171 Version=62 CmdID=8002 Cmd=SYSTEM_MESSAGE UserID=123456789 SN=0 BodySize=154] Body=[00 01 88 43 68 66 2f da 00 00 00 8e 20 e7 b2 be ...][2025-07-03 15:23:06.996] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=113 Version=62 CmdID=8002 Cmd=SYSTEM_MESSAGE UserID=123456789 SN=0 BodySize=96] Body=[00 01 88 43 68 66 2f da 00 00 00 54 e5 a6 82 e6 ...][2025-07-03 15:23:06.996] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=129 Version=62 CmdID=8002 Cmd=SYSTEM_MESSAGE UserID=123456789 SN=0 BodySize=112] Body=[00 00 00 03 68 66 2f da 00 00 00 64 20 e4 bd a0 ...][2025-07-03 15:23:06.997] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=25 Version=62 CmdID=3452 Cmd=LASTVALUE UserID=123456789 SN=0 BodySize=8] Body=[00 00 00 7f 00 00 00 32 ][2025-07-03 15:23:06.997] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=25 Version=62 CmdID=3452 Cmd=LASTVALUE UserID=123456789 SN=0 BodySize=8] Body=[00 00 00 63 00 00 00 02 ][2025-07-03 15:23:06.997] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=25 Version=62 CmdID=2394 Cmd=PET_BOOK_UPDATE UserID=123456789 SN=0 BodySize=8] Body=[00 00 05 1c 00 00 00 01 ][2025-07-03 15:23:06.998] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=25 Version=62 CmdID=3452 Cmd=LASTVALUE UserID=123456789 SN=0 BodySize=8] Body=[00 00 00 2b 00 00 00 3c ][2025-07-03 15:23:06.998] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=25 Version=62 CmdID=3452 Cmd=LASTVALUE UserID=123456789 SN=0 BodySize=8] Body=[00 00 00 2b 00 00 00 00 ][2025-07-03 15:23:06.998] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=25 Version=62 CmdID=3452 Cmd=LASTVALUE UserID=123456789 SN=0 BodySize=8] Body=[00 00 00 2b 00 00 01 54 ][2025-07-03 15:23:06.998] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=25 Version=62 CmdID=3452 Cmd=LASTVALUE UserID=123456789 SN=0 BodySize=8] Body=[00 00 00 2b 00 00 08 8b ][2025-07-03 15:23:06.999] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=25 Version=62 CmdID=3452 Cmd=LASTVALUE UserID=123456789 SN=0 BodySize=8] Body=[00 00 00 2b 00 00 0a 31 ][2025-07-03 15:23:07.031] [ThreadID 0xfb8] [Temp] [Hooked recv] Parsed Data:[Length=3413 Version=62 CmdID=1001 Cmd=LOGIN_IN UserID=123456789 SN=46 BodySize=3396] Body=[0d b2 32 92 4d 71 dc 79 e7 89 9b e6 8e 92 00 00 ...] è¿™é‡Œåªæˆªå–æ­£å¸¸çš„éƒ¨åˆ†ï¼ˆUserIDæˆ‘å°±ç”¨â€123456â€ä»£æ›¿äº†ï¼‰ï¼Œä»æ¥æ”¶åˆ°LOGIN_INæŒ‡ä»¤ä»¥åï¼Œæ•°æ®å˜å¾—éå¸¸å¥‡æ€ªï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œkeyå€¼çš„æ”¹å˜å‘ç”Ÿåœ¨æ¥æ”¶åˆ°LOGIN_INæŒ‡ä»¤åï¼ åœ¨æ–‡ä»¶å¤¹ä¸­æœç´¢LOGIN_INï¼Œç»“æœä¸å¤šï¼ŒæŒ¨ä¸ªæŸ¥çœ‹ä¸‹ï¼Œæœ€åé”å®šåœ¨MainEntry.asï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243private static function onLogin(param1:SocketEvent) : void{ if(SaveUserInfo.loginIDInfo.loginType == 3) { StatManager.sendStat2014(&quot;æ‰‹æœºéªŒè¯ç æ³¨å†Œ/ç™»å½•&quot;,&quot;ã€æ‰‹æœºéªŒè¯ç ç™»å½•ç©å®¶ã€‘ç™»å½•ONLINEæœ&quot;,&quot;æ‰‹æœºéªŒè¯ç &quot;); } if(MainManager.isNewUser) { StatManager.sendStat2014(&quot;_newtrans_&quot;,&quot;fOnlineSucc&quot;,&quot;&quot;); } if(!isReconnect) { SocketConnection.removeCmdListener(CommandID.LOGIN_IN,onLogin); EventManager.addEventListener(RobotEvent.CREATED_ACTOR,onCreatedActor); } else { SocketConnection.removeCmdListener(CommandID.RELOGIN_IN,onLogin); } var _loc2_:int = 0; if(isReconnect) { _loc2_ = int(MainManager.actorInfo.mapID); } MainManager.setup(param1.data,isReconnect,_loc2_); var _loc3_:ByteArray = param1.data as ByteArray; var _loc4_:int = int(_loc3_.readUnsignedInt()); initKey(_loc4_); MainEntry.login10004 = false; LevelManager.openMouseEvent(); if(isReconnect) { MainManager.reconnectRequest(); EventManager.dispatchEvent(new Event(ReconnectCompleteController.RECONNECTSUC)); } if(!isReconnect) { MapConfig.setup(); MapSeatPointConfig.setup(); } sendSystemInfo(); SocketConnection.send(1022,86066824);} ç„¶åæˆ‘ä»¬ä¼šå‘ç°ä¸€ä¸ªç‰¹åˆ«æ˜¾çœ¼çš„å‡½æ•°ï¼šinitKey(_loc4_) 123456789101112131415161718192021private static function initKey(param1:int) : void{ var _loc2_:String = &quot;c&amp;o&amp;m.--rob-ot.c--o-r-e.&amp;n-et.S-oc-ke-t&amp;C-on-n-e-c-t-i-on&quot;; var _loc3_:* = &quot;s*e*tE&amp;&amp;&amp;n*c&quot;; _loc3_ += &quot;r*yp*t&amp;&amp;&amp;&amp;Ke*yS*tr*i&amp;n&amp;&amp;g*Arr&quot;; _loc2_ = StringUtil.replace(_loc2_,&quot;-&quot;,&quot;&quot;); _loc2_ = StringUtil.replace(_loc2_,&quot;&amp;&quot;,&quot;&quot;); _loc3_ = StringUtil.replace(_loc3_,&quot;*&quot;,&quot;&quot;); _loc3_ = StringUtil.replace(_loc3_,&quot;&amp;&quot;,&quot;&quot;); param1 ^= MainManager.actorInfo.userID; var _loc4_:String = MD5.hash(param1 + &quot;&quot;); var _loc5_:* = MainManager.actorInfo.userID + &quot;&quot;; var _loc6_:Array = []; var _loc7_:int = 0; while(_loc7_ &lt; 10) { _loc6_[_loc7_] = &quot;*&quot; + _loc4_.charAt(_loc7_) + &quot;*&quot;; _loc7_++; } getDefinitionByName(_loc2_)[_loc3_](_loc6_);} å¤„ç†ä¸€ä¸‹ï¼Œå°±å¯ä»¥çš„å¾—åˆ°ï¼š 12_loc2_ = &quot;com.robot.core.net.SocketConnection&quot;;_loc3_ = &quot;setEncryptKeyStringArr&quot;; è¿™ç§é¿å…ç›´æ¥é€šè¿‡å­—ç¬¦ä¸²æœç´¢çš„æ–¹æ³•å­¦åˆ°äº†ï¼ å‘ç°æ²¡ï¼Œ_loc3_å°±æ˜¯æˆ‘ä»¬å‰é¢åªèƒ½æ‰¾åˆ°ä¸€å¤„è°ƒç”¨çš„æ–¹æ³•setEncryptKeyStringArrã€‚ åˆ¶ä½œæˆ‘ä»¬è‡ªå·±çš„Hookæœ¬æ–‡ä¸­æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿåœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç›®çš„æ˜¯å¯¹ç½‘ç»œé€šä¿¡ä¸­çš„æ•°æ®åŒ…è¿›è¡Œè§£å¯†ï¼Œå› æ­¤å¦‚ä½•æ•è·æ•°æ®éå¸¸é‡è¦ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®çš„ï¼Œå°±éœ€è¦è¯·å‡ºæœ¬èŠ‚ä¸»è§’ï¼šHookï¼ ä»€ä¹ˆæ˜¯Hook?Hookï¼Œåˆç§°é’©å­ï¼Œæ˜¯ä¸€ç§èƒ½å¤Ÿæ‹¦æˆªå’Œä¿®æ”¹å‡½æ•°æˆ–æ–¹æ³•çš„æŠ€æœ¯ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨ä¸ä¿®æ”¹åŸæœ‰çš„ä»£ç å‰æä¸‹ï¼Œä¿®æ”¹ç¨‹åºçš„è¡Œä¸ºã€‚ ä¾‹å¦‚åœ¨ç½‘ç»œé€šä¿¡ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡æˆ‘ä»¬é€šè¿‡Hookæ‹¦æˆªç½‘ç»œAPIçš„è°ƒç”¨ï¼Œä¾‹å¦‚sendã€recvç­‰ï¼Œè¿™æ ·å°±å¯ä»¥æ•è·ç½‘ç»œé€šä¿¡ä¸­çš„ä¸€æ®µåå…­è¿›åˆ¶æ•°æ®ï¼š 13c 3f 78 6d 6c 20 76 65 72 73 69 6f 6e 3d 22 31 2e 30 22 3f 3e 3c 21 44 4f 43 54 59 50 45 20 63 72 6f 73 73 2d 64 6f 6d 61 69 6e 2d 70 6f 6c 69 63 79 3e 3c 63 72 6f 73 73 2d 64 6f 6d 61 69 6e 2d 70 6f 6c 69 63 79 3e 3c 61 6c 6c 6f 77 2d 61 63 63 65 73 73 2d 66 72 6f 6d 20 64 6f 6d 61 69 6e 3d 22 2a 22 20 74 6f 2d 70 6f 72 74 73 3d 22 2a 22 20 2f 3e 3c 2f 63 72 6f 73 73 2d 64 6f 6d 61 69 6e 2d 70 6f 6c 69 63 79 3e 00 å°†å…¶è½¬æ¢ä¸ºASCIIå­—ç¬¦å°±å¯ä»¥å¾—åˆ°ï¼š 12345&lt;?xml version=&quot;1.0&quot;?&gt;&lt;!DOCTYPE cross-domain-policy&gt;&lt;cross-domain-policy&gt; &lt;allow-access-from domain=&quot;*&quot; to-ports=&quot;*&quot; /&gt;&lt;/cross-domain-policy&gt; å½“ç„¶äº†ï¼Œè¿™ä¸ªè‚¯å®šæ˜¯æˆ‘ä»¬ä¸éœ€è¦çš„æ•°æ®ã€‚ æ€»çš„æ¥è¯´ï¼ŒHookåœ¨æœ¬æ–‡çš„ä½œç”¨å°±æ˜¯æ•è·æˆ‘ä»¬éœ€è¦åˆ†æçš„æ•°æ®åŒ…ã€‚ Hooké€‰æ‹©ä¸€èˆ¬æƒ…å†µä¸‹ï¼ŒHookéƒ½æ˜¯ä»¥DLLçš„å½¢å¼æ³¨å…¥åˆ°è¿›ç¨‹ä¸­ï¼Œç„¶åå¯¹è¿›ç¨‹è¿›è¡Œä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¹Ÿéœ€è¦åˆ¶ä½œDLLæ–‡ä»¶ã€‚ è€ƒè™‘åˆ°ä½¿ç”¨WindowsåŸç”ŸAPIå®ç°Hookéš¾åº¦ä¸å°ï¼Œå› æ­¤æœ¬æ–‡é‡‡ç”¨ç¬¬ä¸‰æ–¹å¼€æºåº“MinHookã€‚ é“¾æ¥ï¼šhttps://github.com/TsudaKageyu/minhook MinHookçš„å®ç°å°±éå¸¸æ–¹ä¾¿äº†ï¼Œå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š 1234567891011121314// åˆå§‹åŒ–MH_STATUS WINAPI MH_Initialize(VOID);// åˆ›å»ºé’©å­ pTargetï¼šéœ€è¦æ›¿æ¢çš„ç›®æ ‡å‡½æ•°åœ°å€ã€‚ pDetourï¼šæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„å‡½æ•°åœ°å€ã€‚ ppOriginalï¼šç”¨äºä¿å­˜åŸå§‹å‡½æ•°æŒ‡é’ˆï¼ˆæ–¹ä¾¿ç»•è¿‡Hookï¼‰MH_STATUS WINAPI MH_CreateHook(LPVOID pTarget, LPVOID pDetour, LPVOID *ppOriginal);// å¯åŠ¨é’©å­MH_STATUS WINAPI MH_EnableHook(LPVOID pTarget)// å…³é—­é’©å­MH_STATUS WINAPI MH_DisableHook(LPVOID pTarget) // æ”¶å·¥åçš„ä¸€äº›å¤„ç†MH_STATUS WINAPI MH_Uninitialize(VOID); Hookåˆå§‹åŒ–åœ¨åˆå§‹åŒ–å‰å‘¢ï¼Œæˆ‘ä»¬åº”å½“æ˜ç¡®éœ€è¦æ‹¦æˆªçš„åœ°æ–¹ï¼Œè¿™é‡Œå°±ä¸å¾—ä¸æåˆ°ws2_32.dllè¿™ä¸ªæ–‡ä»¶äº†ã€‚ ws2_32.dllæ˜¯Windows Sockets APIçš„å®ç°ï¼Œé€šå¸¸ç½‘ç»œé€šä¿¡éƒ½ä¼šç”¨åˆ°å®ƒï¼Œä»¥Flashç«¯ä¸ºä¾‹ï¼Œæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ä¸­é€šå¸¸ä¼šè°ƒç”¨sendå’Œrecvæ–¹æ³•ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æ‹¦æˆªè¿™ä¸¤ä¸ªæ–¹æ³•å³å¯ã€‚ æ ¹æ®MinHookæä¾›çš„åˆå§‹åŒ–åŠæ³•ï¼Œæˆ‘ä»¬éœ€è¦è·å–ï¼š pTargetï¼šéœ€è¦æ›¿æ¢çš„ç›®æ ‡å‡½æ•°åœ°å€ã€‚ pDetourï¼šæˆ‘ä»¬è‡ªå·±åˆ›å»ºçš„å‡½æ•°åœ°å€ã€‚ ppOriginalï¼šç”¨äºä¿å­˜åŸå§‹å‡½æ•°æŒ‡é’ˆï¼ˆæ–¹ä¾¿ç»•è¿‡Hookï¼‰ã€‚ 1234567891011// é¦–å…ˆåŠ è½½ws2_32.dllHMODULE ws2_32 = nullptr;ws2_32 = GetModuleHandleW(L&quot;ws2_32&quot;);// è·å–å‡½æ•°åœ°å€LPVOID targetSend = reinterpret_cast&lt;LPVOID&gt;(GetProcAddress(ws2_32, &quot;send&quot;));LPVOID targetRecv = reinterpret_cast&lt;LPVOID&gt;(GetProcAddress(ws2_32, &quot;recv&quot;));// å®šä¹‰åŸå§‹å‡½æ•°æŒ‡é’ˆdecltype(&amp;recv) originalRecv = nullptr;decltype(&amp;send) originalSend = nullptr; ç®¡é“åˆ«ç€æ€¥ï¼Œæ•è·æ•°æ®å‰è¿˜éœ€è¦äº†è§£ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šç®¡é“ã€‚ å…ˆæ˜ç¡®æˆ‘ä»¬çš„éœ€æ±‚ï¼š å‡è®¾ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªDLLç”¨äºæ³¨å…¥æ¸¸æˆè¿›ç¨‹æ¥æ•è·æ•°æ®åŒ…ï¼Œç„¶åï¼Œæˆ‘ä»¬å¦æœ‰ä¸€ä¸ªç¨‹åºï¼Œéœ€è¦å¯¹æ•è·åˆ°çš„æ•°æ®åŒ…è¿›è¡Œå¤„ç†ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦ä¸€ä¸ªç¨‹åºæ˜¯æ€ä¹ˆå¾—åˆ°DLLæ•è·åˆ°çš„æ•°æ®åŒ…å‘¢ï¼Ÿ ç›¸ä¿¡ä½ ä¹ŸçŸ¥é“ç­”æ¡ˆäº†ï¼Œå½“ç„¶æ˜¯å€ŸåŠ©ç®¡é“è¿™ä¸ªå·¥å…·ã€‚ OKï¼Œé‚£ä¹ˆä»€ä¹ˆæ˜¯ç®¡é“ï¼Ÿ ç®¡é“ï¼ˆPipeï¼‰æ˜¯æ“ä½œç³»ç»Ÿä¸­ä¸€ç§éå¸¸åŸºç¡€ä¸”é‡è¦çš„è¿›ç¨‹é—´é€šä¿¡æœºåˆ¶ã€‚ç®¡é“çš„æœ¬è´¨æ˜¯ä¸€ä¸ªå…±äº«çš„ã€ç‰¹æ®Šçš„æ–‡ä»¶æˆ–å†…æ ¸ç¼“å†²åŒºã€‚å®ƒå…è®¸ä¸€ä¸ªè¿›ç¨‹å°†æ•°æ®å†™å…¥è¿™ä¸ªç¼“å†²åŒºï¼Œè€Œå¦ä¸€ä¸ªè¿›ç¨‹ä»è¿™ä¸ªç¼“å†²åŒºè¯»å–æ•°æ®ã€‚æ•°æ®åœ¨ç®¡é“ä¸­ä»¥å­—èŠ‚æµçš„å½¢å¼å•å‘æµåŠ¨ã€‚ï¼ˆAIå¦‚æ˜¯è¯´ï¼‰ é€šå¸¸å‘¢ï¼Œç®¡é“åˆ†ä¸ºåŒ¿åç®¡é“ä¸å‘½åç®¡é“ã€‚åŒ¿åç®¡é“ä¸€èˆ¬æ˜¯ç”¨ä½œå…·å¤‡äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´ä½¿ç”¨çš„ï¼Œè€Œå‘½åç®¡é“æ˜¯ç”¨ä½œæ²¡æœ‰äº²ç¼˜å…³ç³»çš„è¿›ç¨‹ä¹‹é—´é€šä¿¡çš„ã€‚ ç®¡é“æœ‰äº›ç±»ä¼¼æ•°æ®å’Œç»“æ„ä¸­çš„é˜Ÿåˆ—ï¼Œå®ƒé‡‡ç”¨çš„æ˜¯å…ˆè¿›å…ˆå‡ºçš„é¡ºåºï¼Œå¹¶ä¸”å®ƒæ˜¯å•å‘çš„ã€‚ å¾ˆæ˜¾ç„¶ï¼Œæˆ‘ä»¬è¿™é‡Œéœ€è¦ä½¿ç”¨å‘½åç®¡é“ã€‚ å…·ä½“å®ç°å°±ä¸è¯´äº†ï¼Œç›´æ¥çœ‹æºç ã€‚ æ•°æ®æ•è·ç»å†äº†é‚£ä¹ˆå¤šï¼Œç»ˆäºå¯ä»¥å¼€å§‹æ•è·æ•°æ®äº†ï¼Œè¿™é‡Œå°±ä»¥æ•è·æ¥æ”¶åŒ…ä¸ºä¾‹å­ï¼ˆä¸ºäº†æ–¹ä¾¿ç†è§£ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨ç®¡é“ï¼‰ï¼š 12345678910111213141516171819202122/* Sï¼šå½“å‰æ¥æ”¶æ•°æ®çš„ç«¯ç‚¹ã€‚BufferPtrï¼šæŒ‡å‘ç¼“å†²åŒºçš„æŒ‡é’ˆï¼Œå­˜æ”¾Sæ¥æ”¶çš„æ•°æ®ã€‚Lengthï¼šç¼“å†²åŒºçš„å¤§å°ã€‚Flagï¼šæ¥æ”¶æ ‡å¿—ä½ï¼Œæ§åˆ¶æ¥æ”¶æ–¹å¼ã€‚ï¼ˆæœ¬æ–‡æ²¡æœ‰ç”¨åˆ°ï¼‰*/int WINAPI RecvEvent(SOCKET S, char *BufferPtr, int Length, int Flag){ int Result = OriginalRecv(S, BufferPtr, Length, Flag); // å®é™…æ¥æ”¶åˆ°çš„é•¿åº¦ã€‚ if (g_hookEnabled &amp;&amp; Result &gt; 0) { std::lock_guard&lt;std::mutex&gt; lock(g_DataMutex); std::vector&lt;char&gt; Temp(BufferPtr, BufferPtr + Result); // å¤„ç†æœ¬æ¬¡æ¥æ”¶åˆ°çš„æ•°æ®ã€‚ PacketProcessor::ProcessRecvPacket(S, Temp, Result); } return Result;} å¼€å§‹å¤„ç†æ•°æ®åŒ…ï¼ç°åœ¨æ¥æ”¶åˆ°æ•°æ®åï¼Œå°±éœ€è¦æƒ³åŠæ³•å¯¹æ•°æ®è¿›è¡Œå¤„ç†äº†ã€‚ é¦–å…ˆæˆ‘åˆ›å»ºäº†PacketProcessorç±»ï¼Œç”¨äºå¤„ç†è¿™äº›æ•°æ®ã€‚ 12345678910111213141516171819202122232425262728293031323334struct PacketData{ int32_t Length; // åŒ…é•¿ 4å­—èŠ‚ uint8_t Version; // ç‰ˆæœ¬ 1å­—èŠ‚ int32_t CmdID; // å‘½ä»¤å· 4å­—èŠ‚ int32_t UserID; // ç±³ç±³å· 4å­—èŠ‚ int32_t SN; // åºåˆ—å· 4å­—èŠ‚ std::vector&lt;uint8_t&gt; Body; void LogCout(bool bIsSend) const;};class PacketProcessor{public: static void ProcessRecvPacket(SOCKET Socket, const vector&lt;char&gt; &amp;Data, int Length); static PacketData ParsePacket(const vector&lt;uint8_t&gt; &amp;Packet); static bool ShouldDecrypt(const vector&lt;uint8_t&gt; &amp;Cipher); static vector&lt;uint8_t&gt; DecryptPacket(const vector&lt;uint8_t&gt; &amp;Cipher); static void Logining(PacketData &amp;InPacketData);private: static vector&lt;uint8_t&gt; s_RecvBuf; static size_t s_RecvBufIndex; static size_t s_RecvBufLen; static size_t s_RecvNum; static SOCKET s_CurrentSocket; static bool s_HaveLogin; static size_t s_SN; static int32_t s_UserID;}; åœ¨ä»‹ç»æœ€å…³é”®çš„ProcessRecvPacketå‰å‘¢ï¼Œéœ€è¦å…ˆäº†è§£ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼šç²˜åŒ…å’Œæ‹†åŒ…ã€å¤§ç«¯å’Œå°ç«¯ã€‚ ç²˜åŒ…å’Œæ‹†åŒ…åœ¨ä½¿ç”¨TCPåè®®è¿›è¡Œæ•°æ®ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼ŒTCPä¼šå°†å‘é€æ–¹çš„æ•°æ®å­˜å‚¨åœ¨ç¼“å†²åŒºä¸­ï¼Œå¹¶æ ¹æ®ç½‘ç»œçŠ¶å†µä¼˜åŒ–æ•°æ®åŒ…çš„å¤§å°è¿›è¡Œä¼ è¾“ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒTCPä¸€æ¬¡ä¼ é€’æŠ¥æ–‡æ®µå¯èƒ½ç”±å¤šä¸ªå°çš„æ•°æ®åŒ…ç»„æˆï¼Œæ¥æ”¶æ–¹æ¥æ”¶æ—¶å°±å¯èƒ½å‡ºç°å¤šä¸ªæ•°æ®åŒ…â€œç²˜â€åœ¨ä¸€èµ·çš„ç°è±¡ï¼Œè¿™ç§æƒ…å†µå°±æ˜¯ç²˜åŒ…ï¼›åŒæ ·çš„ï¼Œå¦‚æœå•ä¸ªæ•°æ®åŒ…è¿‡å¤§ï¼Œè¶…è¿‡äº†TCP æŠ¥æ–‡æ®µçš„æœ€å¤§ä¼ è¾“å•å…ƒï¼Œé‚£ä¹ˆTCPä¼šå°†è¿™ä¸ªå¤§çš„æ•°æ®åŒ…æ‹†åˆ†ï¼Œå¹¶åˆ†ä¸ºå¤šä¸ªæŠ¥æ–‡æ®µè¿›è¡Œä¼ è¾“ï¼Œè¿™æ ·å°±é€ æˆäº†æ‹†åŒ…ã€‚ å¤§ç«¯å’Œå°ç«¯å¤§å°ç«¯æ˜¯å¤šå­—èŠ‚æ•°æ®çš„å­˜å‚¨æ–¹å¼ï¼Œå®ƒå†³å®šä¸€ä¸ªå¤šå­—èŠ‚ç±»å‹åœ¨å†…å­˜ä¸­æŒ‰ç…§ä»€ä¹ˆé¡ºåºå­˜æ”¾å„ä¸ªå­—èŠ‚ã€‚ ç®€å•æ¥è¯´ï¼Œå¯¹äºä½œä¸ºæ­£å¸¸äººçš„æˆ‘ä»¬æ¥è¯´ï¼Œå¯¹äº123è¿™ä¸ªæ•°å­—ï¼Œæˆ‘ä»¬éƒ½ä¼šå°†å…¶è¯»ä½œâ€œä¸€ç™¾äºŒåä¸‰â€ï¼Œä¹Ÿå°±æ˜¯å¤§ç«¯ï¼Œå³é«˜ä½åœ¨å‰ï¼Œä½ä½åœ¨åï¼›ä½†æ˜¯ï¼Œå¤„ç†å™¨ä¸è¿™ä¹ˆè®¤ä¸ºï¼Œå®ƒæ˜¯æ€ä¹ˆè¯»çš„å‘¢ï¼Ÿ â€œä¸‰ç™¾äºŒåä¸€â€ ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä¸æ­£å¸¸äººè¯»å–çš„æ–¹å¼å®Œå…¨ç›¸åï¼Œé«˜ä½åœ¨åï¼Œä½ä½åœ¨å‰ã€‚ä¸‹æ–¹æ˜¯æ¯”è¾ƒä¸“ä¸šçš„ä¾‹å­ï¼š 12345æ•´æ•° 0x12345678 çš„å­—èŠ‚æ’åˆ—ï¼šåœ°å€: 0x00 0x01 0x02 0x03å¤§ç«¯: 0x12 0x34 0x56 0x78å°ç«¯: 0x78 0x56 0x34 0x12 ProcessRecvPacketå…ˆè´´ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273void PacketProcessor::ProcessRecvPacket(SOCKET Socket, const vector&lt;char&gt; &amp;Data, int Length){ PacketData RecvPacketData = PacketData(); s_RecvBuf.insert(s_RecvBuf.end(), Data.begin(), Data.begin() + Length); // æ˜¯å¦æ˜¯åŒä¸€è¿æ¥ã€‚ if (s_CurrentSocket != Socket) { s_RecvBufIndex += Length; // æ­¤æ—¶ç´¢å¼•ç­‰äºç¼“å†²åŒºé•¿åº¦ï¼Œåˆ™è¯´æ˜åˆšå¥½å–å®Œæ­¤åŒ…ã€‚ if (s_RecvBufIndex == s_RecvBuf.size()) { s_RecvBuf.clear(); s_RecvBufIndex = 0; } return; } while (true) { size_t Remain = s_RecvBuf.size() - s_RecvBufIndex; // ä¸è¶³åŒ…å¤´é•¿åº¦ï¼Œéœ€ç­‰å¾…ã€‚ if (Remain &lt; sizeof(uint32_t)) break; // è¯»åŒ…ã€‚ uint32_t PacketLength = 0; memcpy(&amp;PacketLength, &amp;s_RecvBuf[s_RecvBufIndex], sizeof(PacketLength)); PacketLength = ntohl(PacketLength); // åŒ…æœªé½ï¼Œéœ€ç­‰å¾…ã€‚ if (Remain &lt; PacketLength) break; vector&lt;uint8_t&gt; Cipher(s_RecvBuf.begin() + s_RecvBufIndex, s_RecvBuf.begin() + s_RecvBufIndex + PacketLength); vector&lt;uint8_t&gt; Plain = ShouldDecrypt(Cipher) ? DecryptPacket(Cipher) : Cipher; RecvPacketData = ParsePacket(Plain); ++s_RecvNum; RecvPacketData.LogCout(false); // å¦‚æœæ˜¯ç™»å½•åŒ… if (RecvPacketData.CmdID == 1001) { Logining(RecvPacketData); s_CurrentSocket = Socket; s_SN = RecvPacketData.SN; s_UserID = RecvPacketData.UserID; s_HaveLogin = true; } s_RecvBufIndex += PacketLength; if (s_RecvBufIndex == s_RecvBuf.size()) { s_RecvBuf.clear(); s_RecvBufIndex = 0; break; } if (s_RecvBufIndex &gt; 0) { s_RecvBuf.erase(s_RecvBuf.begin(), s_RecvBuf.begin() + s_RecvBufIndex); s_RecvBufIndex = 0; // s_CurrentSocket = Socket; } }} ç§ä»¥ä¸ºå…¶ä¸­çš„é‡ç‚¹ä¸ºç²˜åŒ…ã€æ‹†åŒ…ä»¥åŠç™»å½•åŒ…çš„å¤„ç†çš„è§£å†³æ–¹æ³•ã€‚ å…ˆè¯´ç²˜åŒ…å’Œæ‹†åŒ…ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950while (true){ size_t Remain = s_RecvBuf.size() - s_RecvBufIndex; // ä¸è¶³åŒ…å¤´é•¿åº¦ï¼Œéœ€ç­‰å¾…ã€‚ if (Remain &lt; sizeof(uint32_t)) break; // è¯»åŒ…ã€‚ uint32_t PacketLength = 0; memcpy(&amp;PacketLength, &amp;s_RecvBuf[s_RecvBufIndex], sizeof(PacketLength)); PacketLength = ntohl(PacketLength); // åŒ…æœªé½ï¼Œéœ€ç­‰å¾…ã€‚ if (Remain &lt; PacketLength) break; vector&lt;uint8_t&gt; Cipher(s_RecvBuf.begin() + s_RecvBufIndex, s_RecvBuf.begin() + s_RecvBufIndex + PacketLength); vector&lt;uint8_t&gt; Plain = ShouldDecrypt(Cipher) ? DecryptPacket(Cipher) : Cipher; RecvPacketData = ParsePacket(Plain); ++s_RecvNum; RecvPacketData.LogCout(false); // å¦‚æœæ˜¯ç™»å½•åŒ… if (RecvPacketData.CmdID == 1001) { Logining(RecvPacketData); s_CurrentSocket = Socket; s_SN = RecvPacketData.SN; s_UserID = RecvPacketData.UserID; s_HaveLogin = true; } s_RecvBufIndex += PacketLength; if (s_RecvBufIndex == s_RecvBuf.size()) { s_RecvBuf.clear(); s_RecvBufIndex = 0; break; } if (s_RecvBufIndex &gt; 0) { s_RecvBuf.erase(s_RecvBuf.begin(), s_RecvBuf.begin() + s_RecvBufIndex); s_RecvBufIndex = 0; // s_CurrentSocket = Socket; } æˆ‘åˆ›å»ºäº†å¤šä¸ªå…¨å±€å˜é‡ç”¨äºå¤„ç†ä¸Šè¿°é—®é¢˜ï¼š s_RecvBufï¼šæ¥æ”¶ç¼“å†²åŒºï¼Œç”¨äºç¼“å­˜æ¥æ”¶æ¥çš„æ•°æ®æµã€‚ s_RecvBufIndexï¼šå½“å‰å¤„ç†åˆ°çš„æ¥æ”¶ç¼“å†²åŒºç´¢å¼•ã€‚ å¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š åˆ¤å¤´é•¿ï¼Œå…ˆåˆ¤æ–­åŒ…å¤´é•¿åº¦æ˜¯å¦è¶³å¤Ÿï¼Œä¸å¤Ÿåˆ™ç»§ç»­ç­‰å¾…æ–°çš„åŒ…ã€‚ è¯»åŒ…å¤´ï¼Œå°†ç½‘ç»œå­—èŠ‚åºï¼ˆå¤§ç«¯ï¼‰è½¬æ¢ä¸ºæœºå™¨è¯»æ³•ï¼ˆå°ç«¯ï¼‰å¾—åˆ°åŒ…é•¿ã€‚ åˆ¤åŒ…é•¿ï¼Œåˆ¤æ–­å½“å‰ç¼“å†²åŒºçš„åŒ…æ˜¯å¦å®Œæ•´ï¼Œä¸å®Œæ•´ç»§ç»­ç­‰ã€‚ åˆ†æåŒ…ï¼Œæå–å®Œæ•´çš„æ•°æ®åŒ…ï¼Œè¿›è¡Œè§£å¯†åˆ†æã€‚ æ¸…åº“å­˜ï¼Œæ›´æ–°ç¼“å†²åŒºçš„çŠ¶æ€ï¼Œç¡®ä¿ä¸ä¼šå½±å“ä¸‹ä¸€è½®çš„åˆ†æã€‚ å†è¯´ç™»é™†åŒ…çš„å¤„ç†ï¼š 12345678if (RecvPacketData.CmdID == 1001){ Logining(RecvPacketData); s_CurrentSocket = Socket; s_SN = RecvPacketData.SN; s_UserID = RecvPacketData.UserID; s_HaveLogin = true;} éå¸¸çš„æ¸…æ™°ï¼Œå¦‚æœå‘½ä»¤å·ä¸º1001ï¼Œå°±ä»£è¡¨æ­¤æ—¶ä¸ºç™»å½•åŒ…ï¼Œç„¶åä¾ç…§å®˜æ–¹å¤„ç†æ–¹æ³•ï¼Œå¯¹keyè¿›è¡Œå¤„ç†ã€‚ 1234567891011121314151617181920212223242526272829void PacketProcessor::Logining(PacketData &amp;InPacketData){ if (InPacketData.Body.size() &lt; 4) { return; } // 1. å–å°¾ 4 å­—èŠ‚å¹¶æŒ‰â€œå¤§ç«¯â€ç»„è£… size_t n = InPacketData.Body.size(); uint32_t tail4 = (static_cast&lt;uint32_t&gt;(InPacketData.Body[n - 1])) | (static_cast&lt;uint32_t&gt;(InPacketData.Body[n - 2]) &lt;&lt; 8) | (static_cast&lt;uint32_t&gt;(InPacketData.Body[n - 3]) &lt;&lt; 16) | (static_cast&lt;uint32_t&gt;(InPacketData.Body[n - 4]) &lt;&lt; 24); // 2. å¼‚æˆ– userId uint32_t xorRes = tail4 ^ static_cast&lt;uint32_t&gt;(InPacketData.UserID); // 3. è½¬ä¸ºå­—ç¬¦ä¸² std::string plain = std::to_string(xorRes); // 4. è®¡ç®— MD5 MD5 md5; md5.update(reinterpret_cast&lt;const uint8_t *&gt;(plain.data()), plain.size()); md5.finalize(); std::string md5hex = md5.hexdigest(); // 5. å–å‰ 10 å­—ç¬¦ä½œå¯†é’¥ std::string key = md5hex.substr(0, 10); // åˆå§‹åŒ–åŠ å¯†ç®—æ³• Cryptor::InitKey(key);} ç„¶åï¼Œæˆ‘ä»¬å°±å¾—åˆ°çš„å…³é”®é“å…·ï¼škeyã€‚åœ¨è¿™ä¹‹åå‘¢ï¼Œæ‰€æœ‰çš„æ•°æ®åŒ…çš„è§£å¯†éƒ½ä¼šç”¨åˆ°keyï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥éšæ„åœ°æ•è·å¹¶è§£å¯†å°åŒ…äº†ã€‚ æµ‹è¯•ç™»å½•é˜¶æ®µï¼Œå¯ä»¥çœ‹åˆ°LOGIN_INæŒ‡ä»¤åˆ†åˆ«è¿›è¡Œäº†ä¸€æ¬¡å‘é€ä¸ä¸€æ¬¡æ¥æ”¶ã€‚ å°è¯•ç§»åŠ¨ä¸€ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°PEOPLE_WALKåˆ†åˆ«è¢«å‘é€å’Œæ¥æ”¶äº†ä¸€æ¬¡ï¼Œè‡³äºæ—¥å¿—ä¸­ä¸ºä»€ä¹ˆæ˜¯ä¸¤æ¬¡ï¼Œå› ä¸ºç¬¬ä¸€æ¬¡æ²¡æˆªå¥½å›¾ã€‚ é‚£ä¹ˆåˆ°è¿™é‡Œï¼Œå°åŒ…è§£å¯†åŸºæœ¬ç»“æŸäº†ï¼Œä¸‹é¢è¿›å…¥ç¬¬äºŒé˜¶æ®µï¼š â€œå¯¹æˆ˜ä¿¡æ¯æ•è·ä¸UIå±•ç¤ºâ€ è¿™éƒ¨åˆ†å°±è‡ªè¡Œç ”ç©¶å§ï¼ æœ€åæœ¬æ–‡ä»…ç”¨äºæŠ€æœ¯ç ”ç©¶ä¸å­¦ä¹ äº¤æµï¼Œè¯·å‹¿ç”¨äºä»»ä½•å•†ä¸šç”¨é€”ã€‚ æ‰€æœ‰ç›¸å…³èµ„æºç‰ˆæƒå½’ä¸Šæµ·æ·˜ç±³ç½‘ç»œç§‘æŠ€æœ‰é™å…¬å¸æ‰€æœ‰ã€‚ å¦‚å› æ»¥ç”¨æœ¬æ–‡é€ æˆæ³•å¾‹çº çº·ï¼Œè´£ä»»ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ‹…ã€‚ æœ¬æ–‡å‚è€ƒè‡ªèµ›å°”å·ï¼šé€šä¿¡åè®®é€†å‘ä¸æ¨¡æ‹Ÿ&amp;ä¸­é—´äººæ”»å‡»çªƒå–ç™»å½•å‡­è¯ è”ç³»æ–¹å¼ é‚®ç®±ï¼š584485321@qq.com é‚£ä¹ˆæœ€åï¼Œèµ›å°”å·è§ï¼ï¼ï¼","link":"/2025/07/03/game-reversing/network-protocol-reversing/"}],"tags":[],"categories":[{"name":"Java","slug":"Java","link":"/categories/Java/"},{"name":"Java8 æ–°ç‰¹æ€§","slug":"Java/Java8-æ–°ç‰¹æ€§","link":"/categories/Java/Java8-%E6%96%B0%E7%89%B9%E6%80%A7/"},{"name":"Redis","slug":"Redis","link":"/categories/Redis/"},{"name":"èµ›å°”å·é€†å‘","slug":"èµ›å°”å·é€†å‘","link":"/categories/%E8%B5%9B%E5%B0%94%E5%8F%B7%E9%80%86%E5%90%91/"}],"pages":[]}